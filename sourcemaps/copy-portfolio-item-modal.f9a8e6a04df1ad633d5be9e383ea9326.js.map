{"version":3,"file":"js/copy-portfolio-item-modal.405d29698ba4b01f210b.js","mappings":"qSA+BMA,EAAiB,SAACC,GACtB,eAAe,CAAEA,KAAI,GAAI,CAAEC,MAAO,IAAKC,OAAQ,IAAKC,MAAK,SAAC,GACxD,OAD8D,OAE3DC,QACC,SAAC,GAIK,OAFyB,uCAIhCC,KAAI,SAAC,G,IAAEL,EAAI,OAAW,OAAGM,MAAV,KAAqBC,MAAOP,UAG5CQ,EAAa,SACjBC,EACAC,EACAC,GACG,OACHC,OAAQ,CACN,CACEC,UAAW,oBACXb,KAAM,sBACNO,MAAOG,EAAc,UACrBD,QAAO,EACPK,SAAU,gBAEZ,CACED,UAAW,iBACXb,KAAM,eACNO,MAAOG,EAAc,eACrBK,YAAY,EACZC,aAAa,OAAmBjB,GAChCkB,cAAc,EACdC,QAASP,EACTQ,cAAc,MA6FpB,QAhFiF,SAAC,G,IAChFC,EAAW,cACXC,EAAe,kBACfC,EAAQ,WACRC,EAAM,SACNC,EAAa,gBAEPd,GAAgB,SAChBe,GAAW,IAAAC,eACTC,GAAS,IAAAC,cAAY,KAsC7B,OACE,kBAAC,EAAAC,MAAK,CACJC,QAAM,EACNC,MAAOrB,EAAc,mBACrBsB,QAAS,WACP,OAAAL,EAAK,CACHM,SAAUX,EACVC,OAAM,KAGVW,QAAQ,SAER,kBAAC,KAAY,CACXC,cAAe,CAAEC,aAAchB,GAC/BiB,OAAQ7B,GApBU,SAACY,GACvB,OAAC,UAAsBkB,yBACrBjB,EACAD,GACmCjB,MAAK,SAAC,GAAkB,OAAP,iBAgBdO,EAAe,CACjD,CAAEJ,MAAOc,EAAab,MAAOiB,KAE/Be,SArDW,SAAOC,GAA2B,O,OAAA,E,OAAA,E,EAAA,W,2lCAKpB,SAAMf,GACjC,QAAuBe,EAAOJ,gB,OAIhC,OALeK,EAAc,SAI5B,MACM,CAAP,EAAOhB,GACJ,QACCJ,EACAmB,EACAC,IAGDtC,MAAK,SAAC,G,IAAEuC,EAAE,KAAEC,EAA2B,8BACtC,OAAAhB,EAAK,CACHM,SAAU,KACVV,OAAQ,cAAciB,EAAOJ,aAAY,mBAAmBM,EAAE,WAAWC,OAG5ExC,MACC,WACE,OAAAqC,EAAOJ,eAAiBhB,GACxBK,GAAS,QAAiCL,a,YA1BC,K,+QAsD7CwB,SAAU,WACR,OAAAjB,EAAK,CACHM,SAAUX,EACVC,OAAM,KAGVsB,cAAe,CACbC,YAAapC,EAAc,UAC3BqC,cAAe,CAAC,aAAc","sources":["webpack:///./src/smart-components/portfolio/portfolio-item-detail/copy-portfolio-item-modal.tsx"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\nimport { Modal } from '@patternfly/react-core';\n\nimport FormRenderer from '../../common/form-renderer';\nimport { getPortfolioItemApi } from '../../../helpers/shared/user-login';\nimport {\n  copyPortfolioItem,\n  fetchPortfolioItemsWithPortfolio,\n  fetchSelectedPortfolio\n} from '../../../redux/actions/portfolio-actions';\nimport asyncFormValidator from '../../../utilities/async-form-validator';\nimport { listPortfolios } from '../../../helpers/portfolio/portfolio-helper';\nimport { PORTFOLIO_ITEM_ROUTE } from '../../../constants/routes';\nimport actionMessages from '../../../messages/actions.messages';\nimport labelMessages from '../../../messages/labels.messages';\nimport portfolioMessages from '../../../messages/portfolio.messages';\nimport useFormatMessage from '../../../utilities/use-format-message';\nimport {\n  FormatMessage,\n  Full,\n  SelectOptions\n} from '../../../types/common-types';\nimport {\n  Portfolio,\n  PortfolioItem,\n  PortfolioItemNextName\n} from '@redhat-cloud-services/catalog-client';\n\nconst loadPortfolios = (name: string) =>\n  listPortfolios({ name }, { limit: 100, offset: 0 }).then(({ data }) =>\n    data\n      .filter(\n        ({\n          metadata: {\n            user_capabilities: { update }\n          }\n        }) => update\n      )\n      .map(({ name, id }) => ({ value: id, label: name }))\n  );\n\nconst copySchema = (\n  getName: (value: string) => Promise<string | undefined>,\n  formatMessage: FormatMessage,\n  initialOptions: SelectOptions\n) => ({\n  fields: [\n    {\n      component: 'copy-name-display',\n      name: 'portfolio_item_name',\n      label: formatMessage(labelMessages.name),\n      getName,\n      fieldSpy: 'portfolio_id'\n    },\n    {\n      component: 'initial-select',\n      name: 'portfolio_id',\n      label: formatMessage(labelMessages.portfolio),\n      isRequired: true,\n      loadOptions: asyncFormValidator(loadPortfolios),\n      isSearchable: true,\n      options: initialOptions,\n      menuIsPortal: true\n    }\n  ]\n});\n\nexport interface CopyPortfolioItemModalProps {\n  closeUrl: string;\n  portfolioId?: string;\n  portfolioItemId: string;\n  search?: string;\n  portfolioName?: string;\n}\n\nconst CopyPortfolioItemModal: React.ComponentType<CopyPortfolioItemModalProps> = ({\n  portfolioId,\n  portfolioItemId,\n  closeUrl,\n  search,\n  portfolioName\n}) => {\n  const formatMessage = useFormatMessage();\n  const dispatch = useDispatch();\n  const { push } = useHistory();\n\n  const onSubmit = async (values: Full<PortfolioItem>) => {\n    /**\n     * dispatch redux action to set selected portfolio in store\n     * this will ensure that correct portfolio data will be loaded after the redirect occurs\n     */\n    const { value: portfolio } = await dispatch(\n      fetchSelectedPortfolio(values.portfolio_id) as Promise<{\n        value: Full<Portfolio>;\n      }>\n    );\n    return dispatch(\n      (copyPortfolioItem(\n        portfolioItemId,\n        values,\n        portfolio\n      ) as unknown) as Promise<PortfolioItem>\n    )\n      .then(({ id, service_offering_source_ref }) =>\n        push({\n          pathname: PORTFOLIO_ITEM_ROUTE,\n          search: `?portfolio=${values.portfolio_id}&portfolio-item=${id}&source=${service_offering_source_ref}`\n        })\n      )\n      .then(\n        () =>\n          values.portfolio_id === portfolioId &&\n          dispatch(fetchPortfolioItemsWithPortfolio(portfolioId))\n      );\n  };\n\n  const portfolioChange = (portfolioId: string) =>\n    (getPortfolioItemApi().getPortfolioItemNextName(\n      portfolioItemId,\n      portfolioId\n    ) as Promise<PortfolioItemNextName>).then(({ next_name }) => next_name);\n\n  return (\n    <Modal\n      isOpen\n      title={formatMessage(portfolioMessages.copyItemTitle) as string}\n      onClose={() =>\n        push({\n          pathname: closeUrl,\n          search\n        })\n      }\n      variant=\"small\"\n    >\n      <FormRenderer\n        initialValues={{ portfolio_id: portfolioId }}\n        schema={copySchema(portfolioChange, formatMessage, [\n          { value: portfolioId, label: portfolioName }\n        ])}\n        onSubmit={onSubmit}\n        onCancel={() =>\n          push({\n            pathname: closeUrl,\n            search\n          })\n        }\n        templateProps={{\n          submitLabel: formatMessage(actionMessages.save),\n          disableSubmit: ['validating', 'submitting']\n        }}\n      />\n    </Modal>\n  );\n};\n\nexport default CopyPortfolioItemModal;\n"],"names":["loadPortfolios","name","limit","offset","then","filter","map","value","label","copySchema","getName","formatMessage","initialOptions","fields","component","fieldSpy","isRequired","loadOptions","isSearchable","options","menuIsPortal","portfolioId","portfolioItemId","closeUrl","search","portfolioName","dispatch","useDispatch","push","useHistory","Modal","isOpen","title","onClose","pathname","variant","initialValues","portfolio_id","schema","getPortfolioItemNextName","onSubmit","values","portfolio","id","service_offering_source_ref","onCancel","templateProps","submitLabel","disableSubmit"],"sourceRoot":""}