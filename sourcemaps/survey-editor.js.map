{"version":3,"sources":["webpack:///./src/smart-components/survey-editing/survey-editor.js"],"names":["componentProperties","componentTypes","TEXT_FIELD","attributes","fieldProperties","LABEL","HELPER_TEXT","PLACEHOLDER","IS_DISABLED","IS_READ_ONLY","HIDE_FIELD","CHECKBOX","OPTIONS","SELECT","DATE_PICKER","TODAY_BUTTON_LABEL","IS_CLEARABLE","CLOSE_ON_DAY_SELECT","SHOW_TODAY_BUTTON","PLAIN_TEXT","MULTI_LINE_LABEL","RADIO","SWITCH","TEXTAREA","pf4Skin","componentMapper","builderMapper","pickerMapper","propertiesMapper","BuilderWrapper","props","SurveyEditor","closeUrl","search","portfolioItem","uploadIcon","useState","schema","setSchema","isFetching","setIsFetching","baseSchema","setBaseSchema","servicePlan","setServicePlan","dispatch","useDispatch","push","useHistory","getServicePlan","getAxiosInstance","get","CATALOG_API_BASE","id","then","create_json_schema","imported","useEffect","modifySurvey","editedTemplate","getServicePlansApi","patchServicePlanModified","modified","createSurvey","createServicePlan","portfolio_item_id","handleSaveSurvey","addNotification","variant","title","name","dismissable","pathname","error","type","payload","disableDrag","disableAdd","schemaTemplate","mode","getSchema","isValid","key","product","handleResetSurvey","undefined","resetServicePlanModified","propTypes","PropTypes","string","isRequired","func","shape","portfolio","object"],"mappings":"gTAwBMA,GAAmB,WACtBC,iBAAeC,WAAa,CAC3BC,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBE,YAChBF,kBAAgBG,YAChBH,kBAAgBI,YAChBJ,kBAAgBK,aAChBL,kBAAgBM,cARG,MAWtBT,iBAAeU,SAAW,CACzBR,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBI,YAChBJ,kBAAgBQ,QAChBR,kBAAgBM,cAhBG,MAmBtBT,iBAAeY,OAAS,CACvBV,WAAY,CACVC,kBAAgBQ,QAChBR,kBAAgBC,MAChBD,kBAAgBI,YAChBJ,kBAAgBG,YAChBH,kBAAgBE,YAChBF,kBAAgBM,cA1BG,MA6BtBT,iBAAea,YAAc,CAC5BX,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBW,mBAChBX,kBAAgBY,aAChBZ,kBAAgBa,oBAChBb,kBAAgBc,kBAChBd,kBAAgBM,cApCG,MAuCtBT,iBAAekB,WAAa,CAC3BhB,WAAY,CAACC,kBAAgBgB,oBAxCR,MA0CtBnB,iBAAeoB,MAAQ,CACtBlB,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBI,YAChBJ,kBAAgBQ,QAChBR,kBAAgBM,cA/CG,MAkDtBT,iBAAeqB,OAAS,CACvBnB,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBK,aAChBL,kBAAgBI,YAChBJ,kBAAgBM,cAvDG,MA0DtBT,iBAAesB,SAAW,CACzBpB,WAAY,CACVC,kBAAgBC,MAChBD,kBAAgBE,YAChBF,kBAAgBK,aAChBL,kBAAgBI,YAChBJ,kBAAgBM,cAhEG,GAqEnBc,EAAU,CACdC,gBAAiBC,gBACjBC,4BACAC,oCACA5B,uBAGI6B,EAAiB,SAACC,GAAD,OAAW,kBAAC,IAAgBA,IAE7CC,EAAe,SAAC,GAAoD,IAAlDC,EAAkD,EAAlDA,SAAUC,EAAwC,EAAxCA,OAAQC,EAAgC,EAAhCA,cAAeC,EAAiB,EAAjBA,WAAiB,EAC5CC,qBAD4C,WACjEC,EADiE,KACzDC,EADyD,OAEpCF,oBAAS,GAF2B,WAEjEG,EAFiE,KAErDC,EAFqD,OAGpCJ,qBAHoC,WAGjEK,EAHiE,KAGrDC,EAHqD,OAIlCN,qBAJkC,WAIjEO,EAJiE,KAIpDC,EAJoD,KAKlEC,EAAWC,wBACTC,EAASC,cAATD,KACFE,EAAiB,kBACrBC,cACGC,IADH,UAEOC,IAFP,4BAE2ClB,EAAcmB,GAFzD,mBAIGC,MAAK,SAACX,GAAgB,IAGKN,EAHL,IAKjBM,EALiB,MAGjBY,mBAAsBlB,OAI1B,OADAO,EAAeD,EAAY,IACvBA,EAAY,GAAGa,SACVN,cACJC,IADI,UACGC,IADH,0BACqCT,EAAY,GAAGU,GADpD,UAEJC,MAAK,SAACb,GAEL,OADAC,EAAcD,EAAWc,mBAAmBlB,QACrCA,KAINA,KAERiB,MAAK,SAACjB,GACLC,EAAUD,GACVG,GAAc,OAEpBiB,qBAAU,WACRR,MACC,IAEH,IAAMS,EAAe,SAACC,GAAD,OACnBC,cAAqBC,yBAArB,UAAiDlB,EAAYU,IAAM,CACjES,SAAU,CAAEzB,OAAQsB,MAElBI,EAAe,SAACJ,GAAD,OACnBC,cACGI,kBAAkB,CAAEC,kBAAmB/B,EAAcmB,KACrDC,MAAK,+BAAID,MACTC,MAAK,SAACD,GAAD,OACJO,cAAqBC,yBAArB,UAAiDR,GAAM,CACrDS,SAAU,CAAEzB,OAAQsB,SAGtBO,EAAmB,SAACP,GAIxB,OAHAnB,GAAc,IACGG,EAAYa,SAAWE,EAAeK,GAErCJ,GACfL,MAAK,WASJ,OARAd,GAAc,GACdK,EACEsB,0BAAgB,CACdC,QAAS,UACTC,MAAO,aAAF,OAAenC,EAAcoC,KAA7B,uBACLC,aAAa,KAGVxB,EAAK,CAAEyB,SAAUxC,EAAUC,cAV/B,OAYE,SAACwC,GACNjC,GAAc,GACdK,EAAS,CAAE6B,KAAM,uBAAwBC,QAASF,QAoBxD,OACE,kBAAC,WAAD,KACGpC,EACC,kBAACR,EAAD,OACML,EADN,CAEEa,OAAQA,EACRuC,aAAW,EACXC,YAAU,EACVC,eAAgBrC,EAChBsC,KAAK,YAEJ,gBAAGC,EAAH,EAAGA,UAAWC,EAAd,EAAcA,QAAYnD,EAA1B,sCACC,kBAAC,WAAD,KACE,kBAAC,IAAD,CACEoD,IAAI,wBACJ/C,WAAYA,EACZgD,QAASjD,EACTgC,iBAAkB,kBAAMA,EAAiBc,MACzCC,QAASA,EACTjD,SAAUA,EACVC,OAAQA,EACRM,WAAYA,IAAeF,EAC3ByB,SAAUnB,EAAYmB,SACtBsB,kBAAmB,kBAvCN/B,EAuC8BV,EAAYU,GAtCnEf,OAAU+C,QACVzB,cACG0B,yBAAyBjC,GACzBC,KAAKL,GACLK,MAAK,kBACJT,EACEsB,0BAAgB,CACdC,QAAS,UACTC,MAAO,aAAF,OAAenC,EAAcoC,KAA7B,uBACLC,aAAa,QAVG,IAAClB,KAyCf,kBAAC,kBAAoBvB,GAbvB,SAkBJ,kBAAC,WAAD,KACE,kBAAC,IAAD,CACEK,WAAYA,EACZgD,QAASjD,EACTgC,iBAAkBA,EAClBlC,SAAUA,EACVC,OAAQA,EACRM,YAAaF,GAAUE,IAEzB,kBAAC,WAAD,KACE,kBAAC,UAAD,UAQZR,EAAawD,UAAY,CACvBvD,SAAUwD,IAAUC,OAAOC,WAC3BzD,OAAQuD,IAAUC,OAAOC,WACzBvD,WAAYqD,IAAUG,KAAKD,WAC3BxD,cAAesD,IAAUI,MAAM,CAC7BvC,GAAImC,IAAUC,OAAOC,WACrBpB,KAAMkB,IAAUC,OAAOC,aACtBA,WACHG,UAAWL,IAAUM,OAAOJ,YAGf3D","file":"js/survey-editor.js","sourcesContent":["import React, { useEffect, useState, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { useHistory } from 'react-router-dom';\nimport { componentTypes } from '@data-driven-forms/react-form-renderer';\nimport FormBuilder from '@data-driven-forms/form-builder';\nimport {\n  builderMapper,\n  fieldProperties,\n  pickerMapper,\n  propertiesMapper,\n  BuilderTemplate\n} from '@data-driven-forms/form-builder/dist/pf4-builder-mappers';\nimport { Spinner } from '@patternfly/react-core/dist/js/components/Spinner/Spinner';\n\nimport {\n  getAxiosInstance,\n  getServicePlansApi\n} from '../../helpers/shared/user-login';\nimport { CATALOG_API_BASE } from '../../utilities/constants';\nimport { Bullseye } from '@patternfly/react-core';\nimport { SurveyEditingToolbar } from '../portfolio/portfolio-item-detail/portfolio-item-detail-toolbar';\nimport { useDispatch } from 'react-redux';\nimport { addNotification } from '@redhat-cloud-services/frontend-components-notifications';\n\nconst componentProperties = {\n  [componentTypes.TEXT_FIELD]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.HELPER_TEXT,\n      fieldProperties.PLACEHOLDER,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.IS_READ_ONLY,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.CHECKBOX]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.OPTIONS,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.SELECT]: {\n    attributes: [\n      fieldProperties.OPTIONS,\n      fieldProperties.LABEL,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.PLACEHOLDER,\n      fieldProperties.HELPER_TEXT,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.DATE_PICKER]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.TODAY_BUTTON_LABEL,\n      fieldProperties.IS_CLEARABLE,\n      fieldProperties.CLOSE_ON_DAY_SELECT,\n      fieldProperties.SHOW_TODAY_BUTTON,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.PLAIN_TEXT]: {\n    attributes: [fieldProperties.MULTI_LINE_LABEL]\n  },\n  [componentTypes.RADIO]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.OPTIONS,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.SWITCH]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.IS_READ_ONLY,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.HIDE_FIELD\n    ]\n  },\n  [componentTypes.TEXTAREA]: {\n    attributes: [\n      fieldProperties.LABEL,\n      fieldProperties.HELPER_TEXT,\n      fieldProperties.IS_READ_ONLY,\n      fieldProperties.IS_DISABLED,\n      fieldProperties.HIDE_FIELD\n    ]\n  }\n};\n\nconst pf4Skin = {\n  componentMapper: builderMapper,\n  pickerMapper,\n  propertiesMapper,\n  componentProperties\n};\n\nconst BuilderWrapper = (props) => <FormBuilder {...props} />;\n\nconst SurveyEditor = ({ closeUrl, search, portfolioItem, uploadIcon }) => {\n  const [schema, setSchema] = useState();\n  const [isFetching, setIsFetching] = useState(false);\n  const [baseSchema, setBaseSchema] = useState();\n  const [servicePlan, setServicePlan] = useState();\n  const dispatch = useDispatch();\n  const { push } = useHistory();\n  const getServicePlan = () =>\n    getAxiosInstance()\n      .get(\n        `${CATALOG_API_BASE}/portfolio_items/${portfolioItem.id}/service_plans`\n      )\n      .then((servicePlan) => {\n        const [\n          {\n            create_json_schema: { schema }\n          }\n        ] = servicePlan;\n        setServicePlan(servicePlan[0]);\n        if (servicePlan[0].imported) {\n          return getAxiosInstance()\n            .get(`${CATALOG_API_BASE}/service_plans/${servicePlan[0].id}/base`)\n            .then((baseSchema) => {\n              setBaseSchema(baseSchema.create_json_schema.schema);\n              return schema;\n            });\n        }\n\n        return schema;\n      })\n      .then((schema) => {\n        setSchema(schema);\n        setIsFetching(false);\n      });\n  useEffect(() => {\n    getServicePlan();\n  }, []);\n\n  const modifySurvey = (editedTemplate) =>\n    getServicePlansApi().patchServicePlanModified(`${servicePlan.id}`, {\n      modified: { schema: editedTemplate }\n    });\n  const createSurvey = (editedTemplate) =>\n    getServicePlansApi()\n      .createServicePlan({ portfolio_item_id: portfolioItem.id })\n      .then(([{ id }]) => id)\n      .then((id) =>\n        getServicePlansApi().patchServicePlanModified(`${id}`, {\n          modified: { schema: editedTemplate }\n        })\n      );\n  const handleSaveSurvey = (editedTemplate) => {\n    setIsFetching(true);\n    let submitCall = servicePlan.imported ? modifySurvey : createSurvey;\n\n    return submitCall(editedTemplate)\n      .then(() => {\n        setIsFetching(false);\n        dispatch(\n          addNotification({\n            variant: 'success',\n            title: `Survey of ${portfolioItem.name} has been modified.`,\n            dismissable: true\n          })\n        );\n        return push({ pathname: closeUrl, search });\n      })\n      .catch((error) => {\n        setIsFetching(false);\n        dispatch({ type: 'EDIT_SURVEY_REJECTED', payload: error });\n      });\n  };\n\n  const handleResetSurvey = (id) => {\n    setSchema(undefined);\n    getServicePlansApi()\n      .resetServicePlanModified(id)\n      .then(getServicePlan)\n      .then(() =>\n        dispatch(\n          addNotification({\n            variant: 'success',\n            title: `Survey of ${portfolioItem.name} has been restored.`,\n            dismissable: true\n          })\n        )\n      );\n  };\n\n  return (\n    <Fragment>\n      {schema ? (\n        <BuilderWrapper\n          {...pf4Skin}\n          schema={schema}\n          disableDrag\n          disableAdd\n          schemaTemplate={baseSchema}\n          mode=\"subset\"\n        >\n          {({ getSchema, isValid, ...props }) => (\n            <Fragment>\n              <SurveyEditingToolbar\n                key=\"survey-editor-toolbar\"\n                uploadIcon={uploadIcon}\n                product={portfolioItem}\n                handleSaveSurvey={() => handleSaveSurvey(getSchema())}\n                isValid={isValid}\n                closeUrl={closeUrl}\n                search={search}\n                isFetching={isFetching || !schema}\n                modified={servicePlan.modified}\n                handleResetSurvey={() => handleResetSurvey(servicePlan.id)}\n              />\n              <BuilderTemplate {...props} />;\n            </Fragment>\n          )}\n        </BuilderWrapper>\n      ) : (\n        <Fragment>\n          <SurveyEditingToolbar\n            uploadIcon={uploadIcon}\n            product={portfolioItem}\n            handleSaveSurvey={handleSaveSurvey}\n            closeUrl={closeUrl}\n            search={search}\n            isFetching={!schema || isFetching}\n          />\n          <Bullseye>\n            <Spinner />\n          </Bullseye>\n        </Fragment>\n      )}\n    </Fragment>\n  );\n};\n\nSurveyEditor.propTypes = {\n  closeUrl: PropTypes.string.isRequired,\n  search: PropTypes.string.isRequired,\n  uploadIcon: PropTypes.func.isRequired,\n  portfolioItem: PropTypes.shape({\n    id: PropTypes.string.isRequired,\n    name: PropTypes.string.isRequired\n  }).isRequired,\n  portfolio: PropTypes.object.isRequired\n};\n\nexport default SurveyEditor;\n"],"sourceRoot":""}