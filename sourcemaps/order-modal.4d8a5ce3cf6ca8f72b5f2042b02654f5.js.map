{"version":3,"file":"js/order-modal.c10f2340256d4197202d.js","mappings":"odAmIA,QA/FyD,SAAC,G,IAAEA,EAAQ,WAC5D,GAA4B,IAAAC,WAAS,GAApCC,EAAU,KAAEC,EAAW,KACtBC,GAAW,IAAAC,eAAa,OACxBC,GAAS,IAAAC,cAAY,KACvBC,GAAW,IAAAC,eAEXC,GADiB,OAAS,CAAC,mBAAkB,GACd,kBAC7BC,GAAkB,IAAAC,cAGxB,SAAC,GAA4C,OAAT,oCAAuB,cAEvDC,GAAgB,SAEhBC,GAAe,IAAAF,cACnB,SAAC,GAAuC,OAAT,gCAGjC,IAAAG,YAAU,WACRP,GACE,QAAkBE,IAGlBM,MAAK,WAAM,OAAAb,GAAY,QACxB,IAEH,IAAMc,EAAc,WAClB,OAAAX,EAAK,CACHY,SAAUlB,EACVI,OAAM,KA4BV,OACE,kBAAC,EAAAe,MAAK,CACJC,QAAM,EACNC,QAASJ,EACTK,MAAM,mBACNC,QAAQ,SAER,kBAAC,EAAAC,MAAK,CAACC,UAAU,cACf,kBAAC,EAAAC,UAAS,KACR,kBAAC,EAAAC,YAAW,KACV,kBAAC,EAAAC,KAAI,KACH,gCAASjB,EAAckB,UAM9B3B,EACC,kBAAC,IAAc,CAACuB,UAAU,aACxB,kBAAC,EAAAK,QAAO,OAGV,kBAAC,KAAY,CACXC,OAnCgC,SAACA,G,MACjCC,EAA8B,QAAd,EAAAD,MAAAA,OAAM,EAANA,EAAQE,cAAM,eAAEC,KAAI,SAACC,GAMzC,OALIA,EAAMC,wBACDD,EAAME,gBACNF,EAAMG,UAGRH,KAET,OAAO,EAAP,KAAYJ,GAAM,CAAEE,OAAQD,IA0BdO,CACJzB,EAAa,GAAG0B,mBACfT,QAELU,SApDS,SAACC,GAChBlC,GACE,QACE,CACEmC,kBAAmBhC,EAAciC,GACjCC,mBAAoBH,GAEtB/B,IAGJM,KA2CM6B,SAAU7B,EACV8B,cAAe,CACbC,YAAanC,EAAc","sources":["webpack:///./src/smart-components/common/order-modal.tsx"],"sourcesContent":["/* eslint-disable react/prop-types */\nimport React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport {\n  Modal,\n  Level,\n  LevelItem,\n  TextContent,\n  Text\n} from '@patternfly/react-core';\nimport { Spinner } from '@patternfly/react-core/dist/js/components/Spinner/Spinner';\nimport FormRenderer from './form-renderer';\nimport {\n  fetchServicePlans,\n  sendSubmitOrder\n} from '../../redux/actions/order-actions';\nimport SpinnerWrapper from '../../presentational-components/styled-components/spinner-wrapper';\nimport useQuery from '../../utilities/use-query';\nimport { AsyncMiddlewareAction, CatalogRootState } from '../../types/redux';\nimport {\n  PortfolioItem,\n  ServicePlan\n} from '@redhat-cloud-services/catalog-client';\nimport {\n  AnyObject,\n  ApiCollectionResponse,\n  Full\n} from '../../types/common-types';\nimport { Schema } from '@data-driven-forms/react-form-renderer';\nimport labelMessages from '../../messages/labels.messages';\nimport useFormatMessage from '../../utilities/use-format-message';\n\nexport interface OrderModalProps {\n  closeUrl: string;\n}\nconst OrderModal: React.ComponentType<OrderModalProps> = ({ closeUrl }) => {\n  const [isFetching, setFetching] = useState(true);\n  const { search } = useLocation();\n  const { push } = useHistory();\n  const dispatch = useDispatch();\n  const [searchParams] = useQuery(['portfolio-item']);\n  const portfolioItemId = searchParams['portfolio-item'];\n  const { portfolioItem } = useSelector<\n    CatalogRootState,\n    { portfolioItem: PortfolioItem }\n  >(({ portfolioReducer: { portfolioItem } }) => portfolioItem);\n\n  const formatMessage = useFormatMessage();\n\n  const servicePlans = useSelector<CatalogRootState, Full<ServicePlan[]>>(\n    ({ orderReducer: { servicePlans } }) => servicePlans\n  );\n\n  useEffect(() => {\n    dispatch(\n      fetchServicePlans(portfolioItemId) as Promise<\n        AsyncMiddlewareAction<ApiCollectionResponse<ServicePlan[]>>\n      >\n    ).then(() => setFetching(false));\n  }, []);\n\n  const handleClose = () =>\n    push({\n      pathname: closeUrl,\n      search\n    });\n\n  const onSubmit = (data: ServicePlan) => {\n    dispatch(\n      sendSubmitOrder(\n        {\n          portfolio_item_id: portfolioItem.id,\n          service_parameters: data\n        },\n        portfolioItem as Full<PortfolioItem>\n      )\n    );\n    handleClose();\n  };\n\n  const updateValidatorsForSubstitution = (schema: Schema) => {\n    const updatedFields = schema?.fields?.map((field) => {\n      if (field.isSubstitution) {\n        delete field.validate;\n        delete field.dataType;\n      }\n\n      return field;\n    });\n    return { ...schema, fields: updatedFields };\n  };\n\n  return (\n    <Modal\n      isOpen\n      onClose={handleClose}\n      title=\"Order submission\"\n      variant=\"small\"\n    >\n      <Level className=\"pf-u-mb-md\">\n        <LevelItem>\n          <TextContent>\n            <Text>\n              <strong>{portfolioItem.name}</strong>\n            </Text>\n          </TextContent>\n        </LevelItem>\n      </Level>\n\n      {isFetching ? (\n        <SpinnerWrapper className=\"pf-u-m-sm\">\n          <Spinner />\n        </SpinnerWrapper>\n      ) : (\n        <FormRenderer\n          schema={updateValidatorsForSubstitution(\n            ((servicePlans[0].create_json_schema! as AnyObject)\n              .schema as unknown) as Schema\n          )}\n          onSubmit={onSubmit}\n          onCancel={handleClose}\n          templateProps={{\n            submitLabel: formatMessage(labelMessages.confirm)\n          }}\n        />\n      )}\n    </Modal>\n  );\n};\n\nexport default OrderModal;\n"],"names":["closeUrl","useState","isFetching","setFetching","search","useLocation","push","useHistory","dispatch","useDispatch","portfolioItemId","portfolioItem","useSelector","formatMessage","servicePlans","useEffect","then","handleClose","pathname","Modal","isOpen","onClose","title","variant","Level","className","LevelItem","TextContent","Text","name","Spinner","schema","updatedFields","fields","map","field","isSubstitution","validate","dataType","updateValidatorsForSubstitution","create_json_schema","onSubmit","data","portfolio_item_id","id","service_parameters","onCancel","templateProps","submitLabel"],"sourceRoot":""}