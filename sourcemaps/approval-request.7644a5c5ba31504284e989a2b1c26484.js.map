{"version":3,"file":"js/approval-request.3bc090ed3492db884596.js","mappings":"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","sources":["webpack:///./src/smart-components/order/order-detail/approval-request.tsx"],"sourcesContent":["import React, { Fragment, useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  Bullseye,\n  Flex,\n  Spinner,\n  TextContent,\n  Text,\n  TextVariants,\n  TextList,\n  TextListVariants,\n  TextListItem,\n  TextListItemVariants,\n  Title,\n  Grid,\n  GridItem,\n  Stack,\n  StackItem,\n  Card,\n  CardBody\n} from '@patternfly/react-core';\n\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  sortable,\n  SortByDirection,\n  ISortBy,\n  TableText\n} from '@patternfly/react-table';\n\nimport { DateFormat } from '@redhat-cloud-services/frontend-components/DateFormat';\nimport InfoIcon from '@patternfly/react-icons/dist/js/icons/info-icon';\nimport { fetchApprovalRequests } from '../../../redux/actions/order-actions';\nimport ordersMessages from '../../../messages/orders.messages';\nimport statesMessages, {\n  getTranslatableState\n} from '../../../messages/states.messages';\nimport labelMessages from '../../../messages/labels.messages';\nimport useFormatMessage from '../../../utilities/use-format-message';\nimport {\n  AnyObject,\n  ApiCollectionResponse,\n  StringObject\n} from '../../../types/common-types';\nimport {\n  ApprovalRequest,\n  OrderItemStateEnum\n} from '@redhat-cloud-services/catalog-client';\nimport { CatalogRootState } from '../../../types/redux';\nimport { OrderDetail } from '../../../redux/reducers/order-reducer';\nimport orderStatusMapper from '../order-status-mapper';\nimport { MAX_RETRY_LIMIT } from '../../../utilities/constants';\nimport { delay } from '../../../helpers/shared/helpers';\n\n/**\n * We are using type conversion of **request as StringObject** because the generated client does not have correct states listed\n * Probably a discrepancy inside the OpenAPI spec\n */\n\nconst rowOrder = ['updated', 'group_name', 'decision'];\n\nconst checkRequest = async (\n  fetchRequests: () => Promise<ApiCollectionResponse<any>>\n) => {\n  // eslint-disable-next-line no-constant-condition\n  let retries = 0;\n  while (retries <= MAX_RETRY_LIMIT) {\n    const result = await fetchRequests();\n    if (result?.data.length > 0 || retries++ >= MAX_RETRY_LIMIT) {\n      return 'Finished';\n    }\n\n    await delay(3000);\n  }\n};\n\nconst isEmpty = (approvalRequest?: ApiCollectionResponse<ApprovalRequest>) =>\n  !approvalRequest ||\n  !approvalRequest.data ||\n  approvalRequest.data.length === 0;\n\nconst ApprovalRequests: React.ComponentType = () => {\n  const formatMessage = useFormatMessage();\n  const dispatch = useDispatch();\n  const [sortBy, setSortBy] = useState<ISortBy>({});\n  const {\n    order,\n    approvalRequest,\n    platform,\n    orderItem,\n    portfolio,\n    portfolioItem\n  } = useSelector<CatalogRootState, OrderDetail>(\n    ({ orderReducer: { orderDetail } }) => orderDetail\n  );\n  const [isFetching, setFetching] = useState(true);\n\n  useEffect(() => {\n    if (orderItem?.id && isEmpty(approvalRequest)) {\n      setFetching(true);\n      checkRequest(() =>\n        dispatch(\n          (fetchApprovalRequests(orderItem.id!) as unknown) as Promise<\n            ApiCollectionResponse<ApprovalRequest>\n          >\n        )\n      ).then(() => setFetching(false));\n    }\n  }, []);\n\n  const handleSort = (\n    _e: React.SyntheticEvent,\n    index: number,\n    direction: SortByDirection\n  ) => setSortBy({ index, direction });\n\n  if (isEmpty(approvalRequest) && !isFetching) {\n    return (\n      <Bullseye id=\"no-approval-requests\">\n        <Flex direction={{ default: 'column' }} grow={{ default: 'grow' }}>\n          <Bullseye>\n            <InfoIcon size=\"xl\" />\n          </Bullseye>\n          <Bullseye>\n            <Title headingLevel=\"h1\" size=\"2xl\">\n              {formatMessage(ordersMessages.noApprovalRequests)}\n            </Title>\n          </Bullseye>\n        </Flex>\n      </Bullseye>\n    );\n  }\n\n  const columns = [\n    { title: 'Updated', transforms: [sortable] },\n    { title: 'Name', transforms: [sortable] },\n    'Decision'\n  ];\n\n  const approvalRequestDecision = (request: StringObject) =>\n    orderStatusMapper[\n      (statesMessages[getTranslatableState(request.decision)].defaultMessage ||\n        'Unknown') as keyof typeof orderStatusMapper\n    ];\n\n  const rows =\n    approvalRequest?.data\n      .map((request) =>\n        rowOrder.map((key) => {\n          if (key === 'decision') {\n            return (\n              <TableText>\n                <TextContent\n                  style={{\n                    color: approvalRequestDecision(request as StringObject)\n                      .color\n                  }}\n                >\n                  {approvalRequestDecision(request as StringObject).icon}\n                  &nbsp;\n                  {formatMessage(\n                    statesMessages[\n                      getTranslatableState(\n                        (request as StringObject)[key] as OrderItemStateEnum\n                      )\n                    ]\n                  )}\n                </TextContent>\n              </TableText>\n            );\n          }\n\n          if (key === 'updated') {\n            /**\n             * The fragment here is required other wise the super smart PF table will delete the first React element\n             */\n            return (\n              <Fragment>\n                <DateFormat\n                  date={(request as StringObject)[key]}\n                  type=\"exact\"\n                />\n              </Fragment>\n            );\n          }\n\n          return (request as AnyObject)[key];\n        })\n      )\n      .sort((a: AnyObject, b: AnyObject) =>\n        a[sortBy.index!] < b[sortBy.index!]\n          ? -1\n          : a[sortBy.index!] < b[sortBy.index!]\n          ? 1\n          : 0\n      ) || [];\n\n  return (\n    <TextContent>\n      {isEmpty(approvalRequest) ? (\n        <Bullseye>\n          <Flex direction={{ default: 'column' }} grow={{ default: 'grow' }}>\n            <Bullseye id=\"creating-approval-request\">\n              <Title headingLevel=\"h1\" size=\"xl\">\n                {formatMessage(ordersMessages.creatingApprovalRequest)}\n              </Title>\n            </Bullseye>\n            <Bullseye>\n              <Spinner size=\"xl\" />\n            </Bullseye>\n          </Flex>\n        </Bullseye>\n      ) : (\n        <Grid hasGutter>\n          <GridItem md={12} lg={6} xl={4}>\n            <Stack hasGutter>\n              <StackItem>\n                <Card>\n                  <CardBody>\n                    <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n                      {formatMessage(ordersMessages.approvalTitle)}\n                    </Text>\n                    <TextList component={TextListVariants.dl}>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(labelMessages.product)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        {portfolioItem.name}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(ordersMessages.orderID)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        {order.id}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(ordersMessages.orderDate)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        <DateFormat\n                          date={order.created_at}\n                          variant=\"relative\"\n                        />\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(ordersMessages.orderedByLabel)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        {order.owner}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(labelMessages.portfolio)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        {portfolio.name}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dt}>\n                        {formatMessage(labelMessages.platform)}\n                      </TextListItem>\n                      <TextListItem component={TextListItemVariants.dd}>\n                        {platform.name}\n                      </TextListItem>\n                    </TextList>\n                  </CardBody>\n                </Card>\n              </StackItem>\n              <StackItem>\n                <Card>\n                  <CardBody>\n                    <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n                      {formatMessage(ordersMessages.approvalParameters)}\n                    </Text>\n                    <TextList\n                      className=\"overflow-wrap\"\n                      component={TextListVariants.dl}\n                    >\n                      {Object.entries(orderItem?.service_parameters || []).map(\n                        ([key, value]) => (\n                          <Fragment key={key}>\n                            <TextListItem component={TextListItemVariants.dt}>\n                              {key}\n                            </TextListItem>\n                            <TextListItem component={TextListItemVariants.dd}>\n                              {value}\n                            </TextListItem>\n                          </Fragment>\n                        )\n                      )}\n                    </TextList>\n                  </CardBody>\n                </Card>\n              </StackItem>\n            </Stack>\n          </GridItem>\n          <GridItem md={12} lg={6} xl={8}>\n            <Card>\n              <CardBody>\n                <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n                  {formatMessage(ordersMessages.activity)}\n                </Text>\n                <Table\n                  aria-label=\"Approval request activity\"\n                  onSort={handleSort}\n                  sortBy={sortBy}\n                  cells={columns}\n                  rows={\n                    sortBy.direction === SortByDirection.asc\n                      ? rows\n                      : rows.reverse()\n                  }\n                >\n                  <TableHeader />\n                  <TableBody />\n                </Table>\n              </CardBody>\n            </Card>\n          </GridItem>\n        </Grid>\n      )}\n    </TextContent>\n  );\n};\n\nexport default ApprovalRequests;\n"],"names":["rowOrder","isEmpty","approvalRequest","data","length","formatMessage","dispatch","useDispatch","useState","sortBy","setSortBy","useSelector","order","platform","orderItem","portfolio","portfolioItem","isFetching","setFetching","useEffect","fetchRequests","id","retries","result","then","Bullseye","Flex","direction","default","grow","size","Title","headingLevel","columns","title","transforms","sortable","approvalRequestDecision","request","decision","defaultMessage","rows","map","key","TableText","TextContent","style","color","icon","Fragment","date","type","sort","a","b","index","Spinner","Grid","hasGutter","GridItem","md","lg","xl","Stack","StackItem","Card","CardBody","Text","className","component","TextVariants","TextList","TextListVariants","TextListItem","TextListItemVariants","name","created_at","variant","owner","Object","entries","service_parameters","value","Table","onSort","_e","cells","SortByDirection","reverse","TableHeader","TableBody"],"sourceRoot":""}