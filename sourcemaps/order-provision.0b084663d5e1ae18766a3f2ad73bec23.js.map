{"version":3,"file":"js/order-provision.1644519819968.f71a84c73b12a1aaf646.js","mappings":"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","sources":["webpack:///./node_modules/@patternfly/react-icons/dist/js/icons/info-icon.js","webpack:///./src/smart-components/order/order-detail/progress-messages.tsx","webpack:///./src/smart-components/order/order-detail/order-provision.tsx"],"sourcesContent":["\"use strict\"\nexports.__esModule = true;\nexports.InfoIconConfig = {\n  name: 'InfoIcon',\n  height: 512,\n  width: 192,\n  svgPath: 'M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z',\n  yOffset: 0,\n  xOffset: 0,\n};\nexports.InfoIcon = require('../createIcon').createIcon(exports.InfoIconConfig);\nexports[\"default\"] = exports.InfoIcon;","import React from 'react';\n\nimport {\n  TextContent,\n  Text,\n  TextVariants,\n  Grid,\n  Card,\n  CardBody,\n  GridItem,\n  Stack,\n  StackItem\n} from '@patternfly/react-core';\n\nimport ReactJsonView from 'react-json-view';\nimport ordersMessages from '../../../messages/orders.messages';\nimport { FormatMessage } from '../../../types/common-types';\nimport {\n  OrderItem,\n  ProgressMessage\n} from '@redhat-cloud-services/catalog-client';\n\nexport interface ProgressMessagesParams {\n  orderItem: OrderItem;\n  progressMessages: ProgressMessage[];\n  formatMessage: FormatMessage;\n}\n\nconst ProgressMessages: React.ComponentType<ProgressMessagesParams> = ({\n  orderItem,\n  progressMessages,\n  formatMessage\n}) => {\n  return (\n    <Grid hasGutter>\n      <GridItem md={12} lg={6} xl={4}>\n        <Stack hasGutter>\n          <StackItem>\n            <Card>\n              <CardBody>\n                <TextContent>\n                  <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n                    {formatMessage(ordersMessages.orderItemParameters)}\n                  </Text>\n                </TextContent>\n                {orderItem?.service_parameters && (\n                  <ReactJsonView src={orderItem.service_parameters} />\n                )}\n              </CardBody>\n            </Card>\n          </StackItem>\n        </Stack>\n      </GridItem>\n      <GridItem md={12} lg={6} xl={8}>\n        <Card>\n          <CardBody>\n            <TextContent>\n              <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n                {formatMessage(ordersMessages.orderProgressMessages)}\n              </Text>\n            </TextContent>\n            {<ReactJsonView src={progressMessages} />}\n          </CardBody>\n        </Card>\n      </GridItem>\n    </Grid>\n  );\n};\n\nexport default ProgressMessages;\n","import React, { useContext, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  Bullseye,\n  Card,\n  CardBody,\n  Flex,\n  Spinner,\n  Text,\n  TextContent,\n  TextVariants,\n  Title\n} from '@patternfly/react-core';\n\nimport {\n  expandable,\n  ICell,\n  IRowData,\n  Table,\n  TableBody,\n  TableHeader,\n  TableText\n} from '@patternfly/react-table';\n\nimport InfoIcon from '@patternfly/react-icons/dist/js/icons/info-icon';\nimport { fetchOrderProvision } from '../../../redux/actions/order-actions';\nimport { fetchOrderProvision as fetchOrderProvisionS } from '../../../redux/actions/order-actions-s';\nimport ordersMessages from '../../../messages/orders.messages';\nimport useFormatMessage from '../../../utilities/use-format-message';\nimport { CatalogRootState } from '../../../types/redux';\nimport {\n  OrderDetail,\n  OrderProvisionType\n} from '../../../redux/reducers/order-reducer';\nimport statesMessages, {\n  getTranslatableState\n} from '../../../messages/states.messages';\nimport orderStatusMapper from '../order-status-mapper';\nimport {\n  OrderItem,\n  OrderItemStateEnum,\n  ProgressMessage\n} from '@redhat-cloud-services/catalog-client';\nimport { FormatMessage } from '../../../types/common-types';\nimport { DateFormat } from '@redhat-cloud-services/frontend-components/DateFormat';\nimport ProgressMessages from './progress-messages';\nimport UserContext from '../../../user-context';\nimport { hasPermission, isStandalone } from '../../../helpers/shared/helpers';\n\nexport interface RowType {\n  id?: string;\n  parent?: number;\n  isOpen?: boolean;\n  cells: { title: any }[];\n}\n\nexport interface ExpandedRowType {\n  parent: number;\n  isOpen: boolean;\n  cells: { title: any }[];\n}\n\nconst isEmpty = (orderProvision?: OrderProvisionType) =>\n  !orderProvision ||\n  !orderProvision.orderItems ||\n  orderProvision.orderItems.length === 0;\n\nconst OrderProvision: React.ComponentType = () => {\n  const formatMessage = useFormatMessage();\n  const [isFetching, setIsFetching] = useState(true);\n  const dispatch = useDispatch();\n  const { order } = useSelector<CatalogRootState, OrderDetail>(\n    ({ orderReducer: { orderDetail } }) => orderDetail\n  );\n\n  const orderProvision = useSelector<CatalogRootState, OrderProvisionType>(\n    ({ orderReducer: { orderProvision } }) => orderProvision\n  );\n  const { permissions: userPermissions } = useContext(UserContext);\n  const showProgressMessages = isStandalone()\n    ? true\n    : hasPermission(userPermissions, ['catalog:order_processes:link']);\n\n  if (!isFetching && isEmpty(orderProvision)) {\n    return (\n      <Bullseye id=\"no-order-provision\">\n        <Flex direction={{ default: 'column' }} grow={{ default: 'grow' }}>\n          <Bullseye>\n            <InfoIcon size=\"xl\" />\n          </Bullseye>\n          <Bullseye>\n            <Title headingLevel=\"h1\" size=\"2xl\">\n              {formatMessage(ordersMessages.noOrderProvision)}\n            </Title>\n          </Bullseye>\n        </Flex>\n      </Bullseye>\n    );\n  }\n\n  const capitalize = (str: any) => str?.charAt(0).toUpperCase() + str?.slice(1);\n\n  const columns: Array<ICell> = [\n    {\n      title: 'Updated',\n      cellFormatters: showProgressMessages ? [expandable] : []\n    },\n    { title: 'Type' },\n    { title: 'Activity' },\n    { title: '' }\n  ];\n\n  const createOrderItemMainRow = (\n    item: OrderItem,\n    formatMessage: FormatMessage\n  ): RowType => {\n    const translatableState = getTranslatableState(\n      item.state as OrderItemStateEnum\n    );\n    return {\n      id: item.id,\n      isOpen: false,\n      cells: [\n        {\n          title: (\n            <Text className=\"pf-u-mb-0\" component={TextVariants.small}>\n              <DateFormat date={item.updated_at} type=\"exact\" />\n            </Text>\n          )\n        },\n        {\n          title: (\n            <Text className=\"pf-u-mb-0\" component={TextVariants.small}>\n              <TableText>\n                {capitalize(\n                  item.process_scope ||\n                    formatMessage(ordersMessages.defaultOrderItemType)\n                )}\n              </TableText>\n            </Text>\n          )\n        },\n        {\n          title: (\n            <Text className=\"pf-u-mb-0\" component={TextVariants.small}>\n              <TableText>{item.name}</TableText>\n            </Text>\n          )\n        },\n        {\n          title: (\n            <TableText>\n              <TextContent\n                style={{\n                  color:\n                    orderStatusMapper[\n                      item.state as keyof typeof orderStatusMapper\n                    ].color\n                }}\n              >\n                {\n                  orderStatusMapper[\n                    item.state as keyof typeof orderStatusMapper\n                  ].icon\n                }\n                &nbsp;\n                {formatMessage(statesMessages[translatableState])}\n              </TextContent>\n            </TableText>\n          )\n        }\n      ]\n    };\n  };\n\n  const createOrderItemExpandedRow = (\n    item: OrderItem,\n    progressMessages: ProgressMessage[],\n    formatMessage: FormatMessage,\n    key: number\n  ): RowType => {\n    const translatableState = getTranslatableState(\n      item.state as OrderItemStateEnum\n    );\n    return {\n      parent: key * 2,\n      cells: [\n        {\n          title: (\n            <ProgressMessages\n              orderItem={item}\n              progressMessages={progressMessages}\n              formatMessage={formatMessage}\n            />\n          )\n        }\n      ]\n    };\n  };\n\n  const createOrderRow = (\n    item: OrderItem,\n    formatMessage: FormatMessage,\n    key: number\n  ): RowType[] => {\n    const orderRow = [createOrderItemMainRow(item, formatMessage)];\n    if (\n      showProgressMessages &&\n      orderProvision.progressMessageItems &&\n      orderProvision.progressMessageItems.length > 0\n    ) {\n      const progressMessageItem = orderProvision.progressMessageItems.find(\n        (msgItem) => msgItem.orderItemId === item.id\n      );\n      if (progressMessageItem) {\n        orderRow.push(\n          createOrderItemExpandedRow(\n            item,\n            progressMessageItem.progressMessages,\n            formatMessage,\n            key\n          )\n        );\n      }\n    }\n\n    return orderRow;\n  };\n\n  const fetchOrderProvisionData = (orderId: string) => {\n    return isStandalone()\n      ? fetchOrderProvisionS(orderId)\n      : fetchOrderProvision(orderId);\n  };\n\n  const createRows = (): RowType[] => {\n    return orderProvision?.orderItems.reduce(\n      (acc: RowType[], item: OrderItem, key) => {\n        const row = createOrderRow(item, formatMessage, key);\n        return [...acc, ...row];\n      },\n      []\n    );\n  };\n\n  const [rows, setRows] = useState<RowType[]>(createRows());\n\n  useEffect(() => {\n    setIsFetching(true);\n    Promise.all([dispatch(fetchOrderProvisionData(order.id))]).then(() =>\n      setIsFetching(false)\n    );\n  }, []);\n\n  useEffect((): void => {\n    setRows(createRows());\n  }, [orderProvision?.orderItems]);\n\n  const setOpen = (data: RowType[], rowId: any) =>\n    data.map((row) =>\n      row.id === rowId\n        ? {\n            ...row,\n            isOpen: !row.isOpen\n          }\n        : {\n            ...row\n          }\n    );\n\n  const onCollapse = (\n    event: React.MouseEvent,\n    rowIndex: number,\n    isOpen: boolean,\n    rowData: IRowData\n  ): void => {\n    const u_rows = setOpen(rows, rowData.id);\n    setRows(u_rows);\n  };\n\n  return (\n    <TextContent>\n      {isFetching ? (\n        <Bullseye>\n          <Flex direction={{ default: 'column' }} grow={{ default: 'grow' }}>\n            <Bullseye id=\"fetching-order-provision\">\n              <Title headingLevel=\"h1\" size=\"xl\">\n                {formatMessage(ordersMessages.fetchingOrderProvision)}\n              </Title>\n            </Bullseye>\n            <Bullseye>\n              <Spinner size=\"xl\" />\n            </Bullseye>\n          </Flex>\n        </Bullseye>\n      ) : (\n        <Card>\n          <CardBody>\n            <Text className=\"pf-u-mb-md\" component={TextVariants.h2}>\n              {formatMessage(ordersMessages.activity)}\n            </Text>\n            <Table\n              aria-label=\"Order provisioning activity\"\n              cells={columns}\n              rows={rows}\n              onCollapse={showProgressMessages ? onCollapse : undefined}\n            >\n              <TableHeader />\n              <TableBody />\n            </Table>\n          </CardBody>\n        </Card>\n      )}\n    </TextContent>\n  );\n};\n\nexport default OrderProvision;\n"],"names":["exports","name","height","width","svgPath","yOffset","xOffset","orderItem","progressMessages","formatMessage","Grid","hasGutter","GridItem","md","lg","xl","Stack","StackItem","Card","CardBody","TextContent","Text","className","component","TextVariants","service_parameters","src","useState","isFetching","setIsFetching","dispatch","order","orderProvision","userPermissions","useContext","showProgressMessages","orderItems","length","isEmpty","Bullseye","id","Flex","direction","default","grow","size","Title","headingLevel","columns","title","cellFormatters","expandable","createOrderItemMainRow","item","str","translatableState","state","isOpen","cells","DateFormat","date","updated_at","type","TableText","process_scope","charAt","toUpperCase","slice","style","color","icon","createRows","reduce","acc","key","row","orderRow","progressMessageItems","progressMessageItem","find","msgItem","orderItemId","push","parent","createOrderItemExpandedRow","createOrderRow","rows","setRows","useEffect","orderId","Promise","all","then","Spinner","Table","onCollapse","event","rowIndex","rowData","data","rowId","u_rows","map","undefined","TableHeader","TableBody"],"sourceRoot":""}