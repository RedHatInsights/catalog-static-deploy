"use strict";(self.webpackChunkcatalog=self.webpackChunkcatalog||[]).push([[8],{46246:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q});var n,a=r(71002),i=r(93433),u=r(29439),o=r(87462),l=r(45987),s=r(4942),c=r(30624),p=r.n(c),d=r(45697),f=r.n(d),m=r(334),v=r(96354),h=r(13969),b=r(14512),D=r(67463),y=r(15654),E=r(35388),g=r(8896),Z=r(23811),O=r(80887),S=r(77221),P=r(12282),T=r(42697),_=r(45237),V=r(83215),R=r(30137),C=r(64124),I=(0,y.Hx)(),A=function(e,t){return I.patch(E.Vs+"/catalog_service_plans/"+e+"/modified/",t)},j=["propertyValidation","children"],w=["label","initialValueOptions","value","fieldId","innerProps","onChange"],U=["validate"],k=["type"],N=["validate"],X=["type"],q=["getSchema","isValid"];function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=M(M({},b.uD.Pv),{},{propertyName:"isSubstitution",label:"Substitution"}),F=function(e){var t=e.propertyValidation.message,r=e.children,n=(0,l.Z)(e,j);return p().createElement(Z.c,(0,o.Z)({helperTextInvalid:t,validated:t?"error":"default"},n),r)};F.propTypes={propertyValidation:f().shape({message:f().string}),children:f().oneOfType([f().node,f().arrayOf(f().node)])},F.defaultProps={propertyValidation:{}};var G=function(e){var t=e.label,r=e.initialValueOptions,n=e.value,s=e.fieldId,d=e.innerProps.propertyValidation,f=e.onChange,m=(0,l.Z)(e,w),v=(0,c.useState)((0,i.Z)(r)),h=(0,u.Z)(v,2),b=h[0],D=h[1],y=(0,c.useState)(!1),E=(0,u.Z)(y,2),g=E[0],Z=E[1];return b.length>0?p().createElement(F,{label:t,fieldId:s,propertyValidation:d},p().createElement(O.P,{variant:"typeahead",onToggle:Z,isOpen:g,typeAheadAriaLabel:"Select initial value",onSelect:function(e,t){f(t),Z(!1)},placeholderText:"Select initial value",isCreatable:!0,onCreateOption:function(e){return D((function(t){return[].concat((0,i.Z)(t),[e])}))},selections:[n]},b.map((function(e){return p().createElement(S.SelectOption,{key:e,value:e})})))):p().createElement(c.Fragment,null,p().createElement(F,{label:t,fieldId:s,propertyValidation:d},p().createElement(P.oi,(0,o.Z)({id:s,value:void 0===(0,a.Z)(n)?"":n.toString(),onChange:f},m))))};G.propTypes={label:f().oneOfType([f().string]).isRequired,value:f().any,fieldId:f().string.isRequired,innerProps:f().shape({propertyValidation:f().shape({message:f().string})}).isRequired,onChange:f().func,initialValueOptions:f().arrayOf(f().string)},G.defaultProps={onChange:function(){},value:"",initialValueOptions:[]};var H=M(M({},b.oU),{},{input:G}),J=(n={},(0,s.Z)(n,v.Z.TEXT_FIELD,{attributes:[b.uD.GP,b.uD.bw,b.uD.l7,b.uD.Pv,b.uD.l,b.uD.aO,x]}),(0,s.Z)(n,v.Z.CHECKBOX,{attributes:[b.uD.GP,b.uD.Pv,b.uD.JY,b.uD.aO]}),(0,s.Z)(n,v.Z.SELECT,{attributes:[b.uD.JY,b.uD.GP,b.uD.Pv,b.uD.l7,b.uD.bw,b.uD.aO,x]}),(0,s.Z)(n,v.Z.DATE_PICKER,{attributes:[b.uD.GP,b.uD.ol,b.uD.SI,b.uD.fe,b.uD.u5,b.uD.aO,x]}),(0,s.Z)(n,v.Z.PLAIN_TEXT,{attributes:[b.uD.m3,x]}),(0,s.Z)(n,v.Z.RADIO,{attributes:[b.uD.GP,b.uD.Pv,b.uD.JY,b.uD.aO]}),(0,s.Z)(n,v.Z.SWITCH,{attributes:[b.uD.GP,b.uD.l,b.uD.Pv,b.uD.aO]}),(0,s.Z)(n,v.Z.TEXTAREA,{attributes:[b.uD.GP,b.uD.bw,b.uD.l,b.uD.Pv,b.uD.aO,x]}),n);J["select-field"]=J[v.Z.SELECT],J["textarea-field"]=J[v.Z.TEXTAREA];var Y={componentMapper:M({},R.De),builderMapper:M({},b.tm),pickerMapper:M(M({},b.ts),{},{"select-field":b.ts[v.Z.SELECT],"textarea-field":b.ts[v.Z.TEXTAREA]}),propertiesMapper:H,componentProperties:J},B=function(e){return p().createElement(h.Z,e)},K=function(e){var t=e.closeUrl,r=e.search,n=e.portfolioItem,a=(0,c.useState)(),i=(0,u.Z)(a,2),s=i[0],d=i[1],f=(0,c.useState)(!1),v=(0,u.Z)(f,2),h=v[0],Z=v[1],O=(0,c.useState)(),S=(0,u.Z)(O,2),P=S[0],j=S[1],w=(0,c.useState)(),L=(0,u.Z)(w,2),x=L[0],F=L[1],G=(0,c.useState)(0),H=(0,u.Z)(G,2),J=H[0],K=H[1],Q=(0,_.useDispatch)(),W=(0,m.useHistory)().push,$=(0,_.useSelector)((function(e){return e.breadcrumbsReducer.fragments})),z=function(){return(0,y.Hx)().get("".concat(E.Vs,"/portfolio_items/").concat(n.id,"/service_plans/")).then((function(e){var t=e.results;return F(t[0]),t[0].create_json_schema.schema,t[0].imported,(0,y.Hx)().get("".concat(E.Vs,"/catalog_service_plans/").concat(t[0].id,"/base/")).then((function(e){var t=function(e){var t=M({},e);return t.fields=t.fields.map((function(e){var t=e.validate,r=(0,l.Z)(e,U);return t?M(M({},r),{},{validate:t.map((function(e){var t=e.type;return M(M({},(0,l.Z)(e,k)),{},{type:R.NQ[t]||t})}))}):r})),t}(JSON.parse(e.create_json_schema.replace('\\"','"')).schema);return j(t),t}))})).then((function(e){d(e),Z(!1)}))};(0,c.useEffect)((function(){z()}),[]);var ee=function(e){return A("".concat(x.id),{modified:{schema:e}})},te=function(e){return(t={portfolio_item_id:n.id},void 0===r&&(r={}),I.post(E.Vs+"/catalog_service_plans/",t)).then((function(e){return(0,u.Z)(e,1)[0].id})).then((function(t){return A("".concat(t),{modified:{schema:e}})}));var t,r},re=function(e){return Z(!0),(x.imported?ee:te)(function(e){var t=M({},e);return t.fields=t.fields.map((function(e){var t=e.validate,r=(0,l.Z)(e,N);return t?M(M({},r),{},{validate:t.map((function(e){var t=e.type;return M(M({},(0,l.Z)(e,X)),{},{type:t!==C.Z.MAX_NUMBER_VALUE&&t!==C.Z.MIN_NUMBER_VALUE?"".concat(t,"-validator"):t})}))}):r})),t}(function(e){var t=e.fields.map((function(e){var t=e;return t.isSubstitution&&(t.isDisabled=!0,t.placeholder=e.initialValue),t}));return M(M({},e),{},{fields:t})}(e))).then((function(){return Z(!1),Q((0,V.wN)({variant:"success",title:"Survey of ".concat(n.name," has been modified."),dismissable:!0})),W({pathname:t,search:r})})).catch((function(e){Z(!1),Q({type:"EDIT_SURVEY_REJECTED",payload:e})}))};return p().createElement(c.Fragment,null,s?[p().createElement(B,(0,o.Z)({},Y,{key:J,schema:s,disableDrag:!0,disableAdd:!0,schemaTemplate:P,mode:"subset",openEditor:!0}),(function(e){var a=e.getSchema,i=e.isValid,u=(0,l.Z)(e,q);return p().createElement(c.Fragment,null,p().createElement(T.X,{key:"survey-editor-toolbar",handleSaveSurvey:function(){return re(a())},isValid:i,closeUrl:t,search:r,isFetching:h||!s,modified:null==x?void 0:x.modified,breadcrumbfragments:$,handleResetSurvey:function(){return e=x.id,d(void 0),void function(e,t){return I.post(E.Vs+"$/catalog_service_plans/"+e+"/reset/")}(e).then(z).then((function(){return K((function(e){return e+1})),Q((0,V.wN)({variant:"success",title:"Survey of ".concat(n.name," has been restored."),dismissable:!0}))}));var e}}),p().createElement(b.vU,u),";")}))]:p().createElement(c.Fragment,null,p().createElement(T.X,{handleSaveSurvey:re,closeUrl:t,search:r,isFetching:!s||h}),p().createElement(g.b,null,p().createElement(D.Spinner,null))))};K.propTypes={closeUrl:f().string.isRequired,search:f().string,portfolioItem:f().shape({id:f().string.isRequired,name:f().string.isRequired}).isRequired,portfolio:f().object.isRequired};const Q=K}}]);
//# sourceMappingURL=../sourcemaps/survey-editor-s.a991d4dd68ec500eb8f6ba7b95e00e88.js.map