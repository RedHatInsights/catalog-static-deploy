(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{581:function(e,t,r){"use strict";var n=r(12),o=r.n(n),i=r(178),u=r.n(i),a=r(81);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(e){return"string"==typeof e?e.split("?")[0]:"object"===u()(e)?c(c({},e),{},{search:void 0}):e};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.removeSearch,r=e.keepHash,n=Object(a.g)();return c(c({},n),{},{push:function(e){var o=e;return r&&n.location.hash.length>0&&(o="object"===u()(o)?c(c({},o),{},{hash:n.location.hash}):"".concat(o).concat(n.location.hash)),t?n.push(l(o)):n.push(o)}})}},583:function(e,t,r){"use strict";var n=(0,r(29).defineMessages)({noItems:{id:"common.filtering.noItems",defaultMessage:"No items found"},filterByProduct:{id:"common.filtering.filterByProduct",defaultMessage:"Filter by product"},noResults:{id:"common.filtering.noResults",defaultMessage:"No results found"},noResultsDescription:{id:"common.filtering.noResultsDescription",defaultMessage:"No results match the filter criteria. Remove all filters or clear all filters to show results."},clearFilters:{id:"common.filtering.clear-filters",defaultMessage:"Clear all filters"},noProducts:{id:"common.filtering.no-products",defaultMessage:"No products yet"},noRecords:{id:"commonMessages.noRecords",defaultMessage:"No records"},filterByTitle:{id:"tableToolbar.filterByTitle",defaultMessage:"Filter by {title}"},noResultsFound:{id:"tableToolbar.noResultsFound",defaultMessage:"No results found"},noResult:{id:"tableToolbar.noResult",defaultMessage:"No {results}"},unknown:{id:"commonMessages.unknown",defaultMessage:"Unknown"}});t.a=n},607:function(e,t,r){var n=r(750);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},744:function(e,t,r){var n=r(745);e.exports=function(e,t){return n(e,t)}},745:function(e,t,r){var n=r(746),o=r(313);e.exports=function e(t,r,i,u,a){return t===r||(null==t||null==r||!o(t)&&!o(r)?t!=t&&r!=r:n(t,r,i,u,e,a))}},746:function(e,t,r){var n=r(747),o=r(754),i=r(756),u=r(757),a=r(760),s=r(111),c=r(761),l=r(762),p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,d,g,h){var m=s(e),v=s(t),b=m?"[object Array]":a(e),O=v?"[object Array]":a(t),y=(b="[object Arguments]"==b?p:b)==p,j=(O="[object Arguments]"==O?p:O)==p,_=b==O;if(_&&c(e)){if(!c(t))return!1;m=!0,y=!1}if(_&&!y)return h||(h=new n),m||l(e)?o(e,t,r,d,g,h):i(e,t,b,r,d,g,h);if(!(1&r)){var w=y&&f.call(e,"__wrapped__"),P=j&&f.call(t,"__wrapped__");if(w||P){var S=w?e.value():e,x=P?t.value():t;return h||(h=new n),g(S,x,r,d,h)}}return!!_&&(h||(h=new n),u(e,t,r,d,g,h))}},747:function(e,t,r){var n=r(748),o=r(749),i=r(751),u=r(752),a=r(753);function s(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}s.prototype.clear=n,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=u,s.prototype.set=a,e.exports=s},748:function(e,t){e.exports=function(){this.__data__=[],this.size=0}},749:function(e,t,r){var n=r(607),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():o.call(t,r,1),--this.size,!0)}},750:function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},751:function(e,t,r){var n=r(607);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},752:function(e,t,r){var n=r(607);e.exports=function(e){return n(this.__data__,e)>-1}},753:function(e,t,r){var n=r(607);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},754:function(e,t,r){var n=r(311),o=r(755),i=r(312);e.exports=function(e,t,r,u,a,s){var c=1&r,l=e.length,p=t.length;if(l!=p&&!(c&&p>l))return!1;var f=s.get(e);if(f&&s.get(t))return f==t;var d=-1,g=!0,h=2&r?new n:void 0;for(s.set(e,t),s.set(t,e);++d<l;){var m=e[d],v=t[d];if(u)var b=c?u(v,m,d,t,e,s):u(m,v,d,e,t,s);if(void 0!==b){if(b)continue;g=!1;break}if(h){if(!o(t,(function(e,t){if(!i(h,t)&&(m===e||a(m,e,r,u,s)))return h.push(t)}))){g=!1;break}}else if(m!==v&&!a(m,v,r,u,s)){g=!1;break}}return s.delete(e),s.delete(t),g}},755:function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},756:function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},757:function(e,t,r){var n=r(758),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,i,u,a){var s=1&r,c=n(e),l=c.length;if(l!=n(t).length&&!s)return!1;for(var p=l;p--;){var f=c[p];if(!(s?f in t:o.call(t,f)))return!1}var d=a.get(e);if(d&&a.get(t))return d==t;var g=!0;a.set(e,t),a.set(t,e);for(var h=s;++p<l;){var m=e[f=c[p]],v=t[f];if(i)var b=s?i(v,m,f,t,e,a):i(m,v,f,e,t,a);if(!(void 0===b?m===v||u(m,v,r,i,a):b)){g=!1;break}h||(h="constructor"==f)}if(g&&!h){var O=e.constructor,y=t.constructor;O==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof O&&O instanceof O&&"function"==typeof y&&y instanceof y||(g=!1)}return a.delete(e),a.delete(t),g}},758:function(e,t,r){var n=r(759)(Object.keys,Object);e.exports=n},759:function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},760:function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},761:function(e,t){e.exports=function(){return!1}},762:function(e,t){e.exports=function(){return!1}},916:function(e,t,r){"use strict";r.r(t);var n=r(52),o=r.n(n),i=r(12),u=r.n(i),a=r(28),s=r.n(a),c=r(21),l=r.n(c),p=r(0),f=r.n(p),d=r(4),g=r.n(d),h=r(181),m=r(16),v=r(744),b=r.n(v),O=r(179),y=r(17),j=r(13),_=r(185),w=r(138),P=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)n[o]=i[u];return n},S=function(e,t){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:t}]}]},x=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},D=function(e,t,r,n){return{fields:P(r?S(e,t):[],n?x(t):[])}},k=r(133),E=r(628),M=r.n(E),N=r(629),T=r.n(N),R=r(19),G=r(5),I=Object(R.a)(),A=Object(R.f)();function C(e){return F.apply(this,arguments)}function F(){return(F=T()(M.a.mark((function e(t){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.get("".concat(G.e,"/portfolios/").concat(t,"/share_info"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=r(2);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var z=function(e){return{type:U.ab,payload:(t=L({},e),r={permissions:t.permissions.split(","),group_uuids:[t.group_uuid]},A.sharePortfolio(t.id,r))};var t,r},V=function(e){return{type:U.db,payload:(t=L({},e),r={permissions:t.permissions,group_uuids:[t.group_uuid]},A.unsharePortfolio(t.id,r))};var t,r},H=r(83);Object(R.h)();var J=r(82),q=r(581),K=r(191),Q=r(46),W=r(32),X=r(583),Y=r(22),Z=r(195),$=function(e,t){switch(e.length){case 1:return e[0];case 2:return t(Q.a.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return t(Q.a.shareSuccessMultipleGroups,{count:e.length})}},ee=function(e){var t,r=e.shareData,n=e.initialGroups,o=e.removedGroups,i=e.newGroups,u=e.formatMessage,a=e.portfolioName,s=u(Q.a.shareSuccessTitle),c=r.filter((function(e){var t,r=e.permissions,o=e.group_uuid,i=n.find((function(e){return e.group_uuid===o}));return i&&(null==r?void 0:r.split(",").length)!==(null===(t=i.permissions)||void 0===t?void 0:t.split(",").length)})),l=o.filter((function(e){var t=e.group_uuid;return!c.find((function(e){return e.group_uuid===t}))})).length>0,p=i.filter((function(e){var t=e.group_uuid;return!n.find((function(e){return e.group_uuid===t}))})).length>0;return l&&!p&&0===c.length&&(s=u(Q.a.shareSuccessTitleOnlyUnsharing),t=u(Q.a.shareSuccessDescriptionOnlyUnsharing,{name:a(),group:$(o.map((function(e){return e.groupName})),u),b:Z.a})),!l&&p&&0===c.length&&(s=u(Q.a.shareSuccessTitleOnlySharing),t=u(Q.a.shareSuccessDescriptionOnlySharing,{name:a(),group:$(i.map((function(e){return e.groupName})),u),b:Z.a})),!l&&!p&&c.length>0&&(s=u(Q.a.shareSuccessTitleOnlyChaningPermissions),t=u(Q.a.shareSuccessDescriptionOnlyChaningPermissions,{group:$(c.map((function(e){return e.groupName})),u),b:Z.a})),{title:s,description:t}};function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ne=function(e){var t,r,n,i,u,a,c,d,g=e.closeUrl,v=e.removeSearch,P=e.viewState,S=e.portfolioName,x=void 0===S?function(){return""}:S,E=Object(Y.a)(),M=Object(m.useDispatch)(),N=Object(q.a)({removeSearch:v,keepHash:!0}).push,T=Object(J.a)(["portfolio"]),I=l()(T,2),A=I[0].portfolio,F=I[1],B=Object(p.useState)(!0),L=l()(B,2),Z=L[0],$=L[1],te=Object(m.useSelector)((function(e){var t=e.portfolioReducer;return{selectedPortfolio:t.selectedPortfolio,isLoading:t.isLoading}})),ne=te.selectedPortfolio,oe=te.isLoading,ie=Object(m.useSelector)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;Object(p.useEffect)((function(){var e;$(!0),M((e=A,{type:U.G,payload:C(e)})).then((function(){return $(!1)})).catch((function(){return $(!1)}))}),[]);var ue=function(){M(Object(k.m)()),N({pathname:g,search:F})};if(!1===(null==ne||null===(t=ne.metadata)||void 0===t||null===(r=t.user_capabilities)||void 0===r?void 0:r.share)&&!1===(null==ne||null===(n=ne.metadata)||void 0===n||null===(i=n.user_capabilities)||void 0===i?void 0:i.unshare))return f.a.createElement(K.a,null);var ae=Z||oe;return f.a.createElement(O.Modal,{title:E(Q.a.portfolioShareTitle),isOpen:!0,variant:"small",onClose:ue},ae&&f.a.createElement(H.i,null),!ae&&f.a.createElement(_.Stack,{hasGutter:!0},f.a.createElement(w.StackItem,null,f.a.createElement(y.TextContent,null,f.a.createElement(j.Text,null,E(Q.a.portfolioShareDescription,{name:x(A),strong:function(e){return f.a.createElement("strong",{key:"strong"},e)}})))),f.a.createElement(w.StackItem,null,f.a.createElement(h.c,{schema:D((function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(R.a)().get("".concat(G.j,"/groups/").concat(e.length>0?"?name=".concat(e):"")).then((function(e){return e.data.map((function(e){var t=e.uuid;return{label:e.name,value:t}}))}))}(e)}),G.m,!1!==(null==ne||null===(u=ne.metadata)||void 0===u||null===(a=u.user_capabilities)||void 0===a?void 0:a.share),!1!==(null==ne||null===(c=ne.metadata)||void 0===c||null===(d=c.user_capabilities)||void 0===d?void 0:d.unshare)),schemaType:"default",onSubmit:function(e,t){var r=e["shared-groups"],n=[],i=t.getState().initialValues["shared-groups"],u=i.filter((function(e){return!r.find((function(t){return t.group_uuid===e.group_uuid}))})).map((function(e){var t=e.permissions;return re(re({},s()(e,["permissions"])),{},{permissions:t.split(",")})}));r.forEach((function(e){var t=i.find((function(t){return t.group_uuid===e.group_uuid}));t&&!b()(t,e)&&(t.permissions.length>e.permissions.length?u.push({id:A,permissions:["update"],group_uuid:e.group_uuid}):n.push(e)),t||n.push(e)}));var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?V:z;return M(r({id:A,permissions:e.permissions,group_uuid:e.group_uuid}))},c=[].concat(o()(n.map((function(e){return a(e)}))),o()(u.map((function(e){return a(e,!0)}))));ue();var l=ee({shareData:r,initialGroups:i,removedGroups:u,newGroups:n,formatMessage:E,portfolioName:x}),p=l.title,f=l.description;return Promise.all(c).then((function(){return M({type:W.ADD_NOTIFICATION,payload:{dismissable:!0,variant:"success",title:p,description:f}}),M(Object(k.g)(P))}))},onCancel:ue,validate:function(e){var t={};return e.group_uuid&&!e.permissions&&(t.permissions=E(Q.a.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(t.group_uuid=E(Q.a.portfolioShareGroups)),t},initialValues:re(re({},ne),{},{"shared-groups":ie.map((function(e){var t=e.permissions.filter((function(e){return G.n.indexOf(e)>-1})),r=e.group_name,n=G.m.find((function(e){return e.value===t.sort().join(",")}));return{groupName:r,group_uuid:e.group_uuid,permissions:n?n.value:E(X.a.unknown)}}))}),formContainer:"modal",templateProps:{disableSubmit:["pristine","validating"],submitLabel:E(Q.a.portfolioShareApply)}}))))};ne.propTypes={closeUrl:g.a.string.isRequired,removeSearch:g.a.bool,portfolioName:g.a.func,viewState:g.a.shape({count:g.a.number,limit:g.a.number,offset:g.a.number,filter:g.a.string})};t.default=ne}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio~31ecd969.js.map