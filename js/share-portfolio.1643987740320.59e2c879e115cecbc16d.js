"use strict";(self.webpackChunkcatalog=self.webpackChunkcatalog||[]).push([[8249],{97881:(e,r,n)=>{n.d(r,{Z:()=>t});const t=(0,n(50049).vU)({noItems:{id:"common.filtering.noItems",defaultMessage:"No items found"},filterByProduct:{id:"common.filtering.filterByProduct",defaultMessage:"Filter by product"},noResults:{id:"common.filtering.noResults",defaultMessage:"No results found"},noResultsDescription:{id:"common.filtering.noResultsDescription",defaultMessage:"No results match the filter criteria. Remove all filters or clear all filters to show results."},clearFilters:{id:"common.filtering.clear-filters",defaultMessage:"Clear all filters"},noProducts:{id:"common.filtering.no-products",defaultMessage:"No products yet"},noRecords:{id:"commonMessages.noRecords",defaultMessage:"No records"},filterByTitle:{id:"tableToolbar.filterByTitle",defaultMessage:"Filter by {title}"},noResultsFound:{id:"tableToolbar.noResultsFound",defaultMessage:"No results found"},noResult:{id:"tableToolbar.noResult",defaultMessage:"No {results}"},unknown:{id:"commonMessages.unknown",defaultMessage:"Unknown"}})},24537:(e,r,n)=>{n.r(r),n.d(r,{default:()=>F});var t=n(30624),o=n.n(t),i=n(30137),s=n(14494),u=n(18446),a=n.n(u),l=n(65832),p=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},c=function(e,r){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:r}]}]},f=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},d=n(89231),m=n(77503),g=n(22437),h=n(35388),v=(0,g.Hx)(),y=(0,g._f)(),b=function(e){return v.get(h.Vs+"/portfolios/"+e+"/share_info")},_=n(90060),O=function(){return(O=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},S=function(e){return{type:_.cc,payload:(r=O({},e),n={permissions:r.permissions.split(","),group_uuids:[r.group_uuid]},y.sharePortfolio(r.id,n))};var r,n},w=function(e){return{type:_.tD,payload:(r=O({},e),n={permissions:r.permissions,group_uuids:[r.group_uuid]},y.unsharePortfolio(r.id,n))};var r,n},P=(0,g.Hx)(),Z=((0,g._f)(),function(e){return P.get(h.Vs+"/portfolios/"+e+"/share_info/")}),M=function(){return(M=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},j=function(e){return{type:_.cc,payload:(r=M({},e),n={permissions:r.permissions.split(","),groups:[r.group_uuid]},P.post(h.Vs+"/portfolios/"+r.id+"/share/",n))};var r,n},N=function(e){return{type:_.tD,payload:(r=M({},e),n={permissions:r.permissions,groups:[r.group_uuid]},P.post(h.Vs+"/portfolios/"+r.id+"/unshare/",n))};var r,n},k=n(8666),R=((0,g.o0)(),n(47786)),E=n(74798),T=n(9456),D=n(64466),I=n(83215),G=n(97881),x=n(23349),V=n(56915),C=function(e,r){switch(e.length){case 1:return e[0];case 2:return r(D.Z.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return r(D.Z.shareSuccessMultipleGroups,{count:e.length})}};var H=n(63035),W=function(){return(W=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},A=function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)r.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(n[t[o]]=e[t[o]])}return n},$=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))};const F=function(e){var r,n,u,v,y,O,P,M,F=e.closeUrl,U=e.removeSearch,B=e.viewState,L=e.portfolioName,J=void 0===L?function(){return""}:L,q=(0,x.Z)(),z=(0,s.I0)(),K=(0,E.Z)({removeSearch:U,keepHash:!0}).push,Q=(0,R.Z)(["portfolio"]),X=Q[0].portfolio,Y=Q[1],ee=(0,t.useState)(!0),re=ee[0],ne=ee[1],te=(0,s.v9)((function(e){var r=e.portfolioReducer;return{selectedPortfolio:r.selectedPortfolio,isLoading:r.isLoading}})),oe=te.selectedPortfolio,ie=te.isLoading,se=(0,s.v9)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;(0,t.useEffect)((function(){var e;ne(!0),z((0,H.$W)()?(e=X,{type:_.oI,payload:Z(e)}):function(e){return{type:_.oI,payload:b(e)}}(X)).then((function(){return ne(!1)})).catch((function(){return ne(!1)}))}),[]);var ue=function(){z((0,H.$W)()?(0,m.So)():(0,d.So)()),K({pathname:F,search:Y})};if(!1===(null===(n=null===(r=null==oe?void 0:oe.metadata)||void 0===r?void 0:r.user_capabilities)||void 0===n?void 0:n.share)&&!1===(null===(v=null===(u=null==oe?void 0:oe.metadata)||void 0===u?void 0:u.user_capabilities)||void 0===v?void 0:v.unshare))return o().createElement(T.M,null);var ae,le,pe,ce,fe=re||ie;return o().createElement(l.Modal,{title:q(D.Z.portfolioShareTitle),isOpen:!0,variant:"small",onClose:ue},fe&&o().createElement(k.Aj,null),!fe&&o().createElement(l.Stack,{hasGutter:!0},o().createElement(l.StackItem,null,o().createElement(l.TextContent,null,o().createElement(l.Text,null,q(D.Z.portfolioShareDescription,{name:J(X),strong:function(e){return o().createElement("strong",{key:"strong"},e)}})))),o().createElement(l.StackItem,null,o().createElement(i.ZP,{schema:(ae=function(e){return(0,H.$W)()?(void 0===(r=e)&&(r=""),(0,g.Hx)().get(h.OJ+"/groups/"+(r.length>0?"?name="+r:"")).then((function(e){return e.results.map((function(e){var r=e.id;return{label:e.name,value:r}}))}))):function(e){return void 0===e&&(e=""),(0,g.Hx)().get(h.OJ+"/groups/"+(e.length>0?"?name="+e:"")).then((function(e){return e.data.map((function(e){var r=e.uuid;return{label:e.name,value:r}}))}))}(e);var r},le=h.nR,pe=!1!==(null===(O=null===(y=null==oe?void 0:oe.metadata)||void 0===y?void 0:y.user_capabilities)||void 0===O?void 0:O.share),ce=!1!==(null===(M=null===(P=null==oe?void 0:oe.metadata)||void 0===P?void 0:P.user_capabilities)||void 0===M?void 0:M.unshare),{fields:p(p([],pe?c(ae,le):[],!0),ce?f(le):[],!0)}),onSubmit:function(e,r){var n=e["shared-groups"],t=[],o=r.getState().initialValues["shared-groups"],i=o.filter((function(e){return!n.find((function(r){return r.group_uuid===e.group_uuid}))})).map((function(e){var r=e.permissions,n=A(e,["permissions"]);return W(W({},n),{permissions:r.split(",")})}));n.forEach((function(e){var r=o.find((function(r){return r.group_uuid===e.group_uuid}));r&&!a()(r,e)&&(r.permissions.length>e.permissions.length?i.push({id:X,permissions:["update"],group_uuid:e.group_uuid,groupName:e.groupName}):t.push(e)),r||t.push(e)}));var s=function(e,r){void 0===r&&(r=!1);var n=r?w:S;return(0,H.$W)()&&(n=r?N:j),z(n({id:X,permissions:e.permissions,group_uuid:e.group_uuid}))},u=$($([],t.map((function(e){return s(e)})),!0),i.map((function(e){return s(e,!0)})),!0);ue();var l=function(e){var r,n=e.shareData,t=e.initialGroups,o=e.removedGroups,i=e.newGroups,s=e.formatMessage,u=e.portfolioName,a=s(D.Z.shareSuccessTitle),l=n.filter((function(e){var r,n=e.permissions,o=e.group_uuid,i=t.find((function(e){return e.group_uuid===o}));return i&&(null==n?void 0:n.split(",").length)!==(null===(r=i.permissions)||void 0===r?void 0:r.split(",").length)})),p=o.filter((function(e){var r=e.group_uuid;return!l.find((function(e){return e.group_uuid===r}))})).length>0,c=i.filter((function(e){var r=e.group_uuid;return!t.find((function(e){return e.group_uuid===r}))})).length>0;return p&&!c&&0===l.length&&(a=s(D.Z.shareSuccessTitleOnlyUnsharing),r=s(D.Z.shareSuccessDescriptionOnlyUnsharing,{name:u(),group:C(o.map((function(e){return e.groupName})),s),b:V.d})),!p&&c&&0===l.length&&(a=s(D.Z.shareSuccessTitleOnlySharing),r=s(D.Z.shareSuccessDescriptionOnlySharing,{name:u(),group:C(i.map((function(e){return e.groupName})),s),b:V.d})),!p&&!c&&l.length>0&&(a=s(D.Z.shareSuccessTitleOnlyChaningPermissions),r=s(D.Z.shareSuccessDescriptionOnlyChaningPermissions,{group:C(l.map((function(e){return e.groupName})),s),b:V.d})),{title:a,description:r}}({shareData:n,initialGroups:o,removedGroups:i.map((function(e){var r=e.permissions,n=A(e,["permissions"]);return W(W({},n),{permissions:r.join(",")})})),newGroups:t,formatMessage:q,portfolioName:J}),p=l.title,c=l.description;return Promise.all(u).then((function(){return z({type:I.Dv,payload:{dismissable:!0,variant:"success",title:p,description:c}}),z((0,H.$W)()?(0,m.eV)(B):(0,d.eV)(B))}))},onCancel:ue,validate:function(e){var r={};return e.group_uuid&&!e.permissions&&(r.permissions=q(D.Z.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(r.group_uuid=q(D.Z.portfolioShareGroups)),r},initialValues:W(W({},oe),{"shared-groups":se.map((function(e){var r=e.permissions.filter((function(e){return h.W5.indexOf(e)>-1})),n=e.group_name,t=h.nR.find((function(e){return e.value===r.sort().join(",")}));return{groupName:n,group_uuid:(0,H.$W)()?e.group_id:e.group_uuid,permissions:t?t.value:q(G.Z.unknown)}}))}),templateProps:{disableSubmit:["pristine","validating"],submitLabel:q(D.Z.portfolioShareApply)}}))))}},74798:(e,r,n)=>{n.d(r,{Z:()=>i});var t=n(334),o=function(){return(o=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};const i=function(e){var r=void 0===e?{}:e,n=r.removeSearch,i=r.keepHash,s=(0,t.useHistory)();return o(o({},s),{push:function(e){var r=e;return i&&s.location.hash.length>0&&(r="object"==typeof r?o(o({},r),{hash:s.location.hash}):""+r+s.location.hash),n?s.push(function(e){return"string"==typeof e?e.split("?")[0]:"object"==typeof e?o(o({},e),{search:void 0}):e}(r)):s.push(r)}})}}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio.8d5a43613f928029f31e03eb9eb269bf.js.map