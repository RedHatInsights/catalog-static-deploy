"use strict";(self.webpackChunkcatalog=self.webpackChunkcatalog||[]).push([[8249],{97881:(e,r,t)=>{t.d(r,{Z:()=>n});const n=(0,t(50049).vU)({noItems:{id:"common.filtering.noItems",defaultMessage:"No items found"},filterByProduct:{id:"common.filtering.filterByProduct",defaultMessage:"Filter by product"},noResults:{id:"common.filtering.noResults",defaultMessage:"No results found"},noResultsDescription:{id:"common.filtering.noResultsDescription",defaultMessage:"No results match the filter criteria. Remove all filters or clear all filters to show results."},clearFilters:{id:"common.filtering.clear-filters",defaultMessage:"Clear all filters"},noProducts:{id:"common.filtering.no-products",defaultMessage:"No products yet"},noRecords:{id:"commonMessages.noRecords",defaultMessage:"No records"},filterByTitle:{id:"tableToolbar.filterByTitle",defaultMessage:"Filter by {title}"},noResultsFound:{id:"tableToolbar.noResultsFound",defaultMessage:"No results found"},noResult:{id:"tableToolbar.noResult",defaultMessage:"No {results}"},unknown:{id:"commonMessages.unknown",defaultMessage:"Unknown"}})},24537:(e,r,t)=>{t.r(r),t.d(r,{default:()=>U});var n=t(30624),o=t.n(n),i=t(30137),s=t(14494),u=t(18446),a=t.n(u),l=t(65832),c=function(e,r,t){if(t||2===arguments.length)for(var n,o=0,i=r.length;o<i;o++)!n&&o in r||(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))},p=function(e,r){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:r}]}]},f=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},d=t(89231),g=t(77503),m=t(22437),h=t(35388),v=(0,m.Hx)(),y=(0,m._f)(),b=function(e){return v.get(h.Vs+"/portfolios/"+e+"/share_info")},_=t(90060),S=function(){return(S=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},O=function(e){return{type:_.cc,payload:(r=S({},e),t={permissions:r.permissions.split(","),group_uuids:[r.group_uuid]},y.sharePortfolio(r.id,t))};var r,t},w=function(e){return{type:_.tD,payload:(r=S({},e),t={permissions:r.permissions,group_uuids:[r.group_uuid]},y.unsharePortfolio(r.id,t))};var r,t},P=(0,m.Hx)(),Z=((0,m._f)(),function(e){return P.get(h.Vs+"/portfolios/"+e+"/share_info/")}),M=function(){return(M=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},j=function(e){return{type:_.cc,payload:(r=M({},e),t={permissions:r.permissions.split(","),groups:[r.group_uuid]},P.post(h.Vs+"/portfolios/"+r.id+"/share/",t))};var r,t},I=function(e){return{type:_.tD,payload:(r=M({},e),t={permissions:r.permissions,groups:[r.group_uuid]},P.post(h.Vs+"/portfolios/"+r.id+"/unshare/",t))};var r,t},N=t(8666),k=((0,m.o0)(),t(47786)),R=t(74798),E=t(9456),T=t(64466),D=t(83215),G=t(97881),x=t(23349),V=t(56915),C=function(e,r){switch(e.length){case 1:return e[0];case 2:return r(T.Z.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return r(T.Z.shareSuccessMultipleGroups,{count:e.length})}};var H=function(){return(H=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},A=function(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(t[n[o]]=e[n[o]])}return t},F=function(e,r,t){if(t||2===arguments.length)for(var n,o=0,i=r.length;o<i;o++)!n&&o in r||(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))};const U=function(e){var r,t,u,v,y,S,P,M,U=e.closeUrl,B=e.removeSearch,L=e.viewState,J=e.portfolioName,W=void 0===J?function(){return""}:J,q=(0,x.Z)(),z=(0,s.I0)(),K=(0,R.Z)({removeSearch:B,keepHash:!0}).push,Q=(0,k.Z)(["portfolio"]),X=Q[0].portfolio,Y=Q[1],$=(0,n.useState)(!0),ee=$[0],re=$[1],te=(0,s.v9)((function(e){var r=e.portfolioReducer;return{selectedPortfolio:r.selectedPortfolio,isLoading:r.isLoading}})),ne=te.selectedPortfolio,oe=te.isLoading,ie=(0,s.v9)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;(0,n.useEffect)((function(){var e;re(!0),z(localStorage.getItem("catalog_standalone")?(e=X,{type:_.oI,payload:Z(e)}):function(e){return{type:_.oI,payload:b(e)}}(X)).then((function(){return re(!1)})).catch((function(){return re(!1)}))}),[]);var se=function(){z(localStorage.getItem("catalog_standalone")?(0,g.So)():(0,d.So)()),K({pathname:U,search:Y})};if(!1===(null===(t=null===(r=null==ne?void 0:ne.metadata)||void 0===r?void 0:r.user_capabilities)||void 0===t?void 0:t.share)&&!1===(null===(v=null===(u=null==ne?void 0:ne.metadata)||void 0===u?void 0:u.user_capabilities)||void 0===v?void 0:v.unshare))return o().createElement(E.M,null);var ue,ae,le,ce,pe=ee||oe;return o().createElement(l.Modal,{title:q(T.Z.portfolioShareTitle),isOpen:!0,variant:"small",onClose:se},pe&&o().createElement(N.Aj,null),!pe&&o().createElement(l.Stack,{hasGutter:!0},o().createElement(l.StackItem,null,o().createElement(l.TextContent,null,o().createElement(l.Text,null,q(T.Z.portfolioShareDescription,{name:W(X),strong:function(e){return o().createElement("strong",{key:"strong"},e)}})))),o().createElement(l.StackItem,null,o().createElement(i.ZP,{schema:(ue=function(e){return localStorage.getItem("catalog_standalone")?(void 0===(r=e)&&(r=""),(0,m.Hx)().get(h.OJ+"/groups/"+(r.length>0?"?name="+r:"")).then((function(e){return e.results.map((function(e){var r=e.id;return{label:e.name,value:r}}))}))):function(e){return void 0===e&&(e=""),(0,m.Hx)().get(h.OJ+"/groups/"+(e.length>0?"?name="+e:"")).then((function(e){return e.data.map((function(e){var r=e.uuid;return{label:e.name,value:r}}))}))}(e);var r},ae=h.nR,le=!1!==(null===(S=null===(y=null==ne?void 0:ne.metadata)||void 0===y?void 0:y.user_capabilities)||void 0===S?void 0:S.share),ce=!1!==(null===(M=null===(P=null==ne?void 0:ne.metadata)||void 0===P?void 0:P.user_capabilities)||void 0===M?void 0:M.unshare),{fields:c(c([],le?p(ue,ae):[],!0),ce?f(ae):[],!0)}),onSubmit:function(e,r){var t=e["shared-groups"],n=[],o=r.getState().initialValues["shared-groups"],i=o.filter((function(e){return!t.find((function(r){return r.group_uuid===e.group_uuid}))})).map((function(e){var r=e.permissions,t=A(e,["permissions"]);return H(H({},t),{permissions:r.split(",")})}));t.forEach((function(e){var r=o.find((function(r){return r.group_uuid===e.group_uuid}));r&&!a()(r,e)&&(r.permissions.length>e.permissions.length?i.push({id:X,permissions:["update"],group_uuid:e.group_uuid,groupName:e.groupName}):n.push(e)),r||n.push(e)}));var s=function(e,r){void 0===r&&(r=!1);var t=r?w:O;return localStorage.getItem("catalog_standalone")&&(t=r?I:j),z(t({id:X,permissions:e.permissions,group_uuid:e.group_uuid}))},u=F(F([],n.map((function(e){return s(e)})),!0),i.map((function(e){return s(e,!0)})),!0);se();var l=function(e){var r,t=e.shareData,n=e.initialGroups,o=e.removedGroups,i=e.newGroups,s=e.formatMessage,u=e.portfolioName,a=s(T.Z.shareSuccessTitle),l=t.filter((function(e){var r,t=e.permissions,o=e.group_uuid,i=n.find((function(e){return e.group_uuid===o}));return i&&(null==t?void 0:t.split(",").length)!==(null===(r=i.permissions)||void 0===r?void 0:r.split(",").length)})),c=o.filter((function(e){var r=e.group_uuid;return!l.find((function(e){return e.group_uuid===r}))})).length>0,p=i.filter((function(e){var r=e.group_uuid;return!n.find((function(e){return e.group_uuid===r}))})).length>0;return c&&!p&&0===l.length&&(a=s(T.Z.shareSuccessTitleOnlyUnsharing),r=s(T.Z.shareSuccessDescriptionOnlyUnsharing,{name:u(),group:C(o.map((function(e){return e.groupName})),s),b:V.d})),!c&&p&&0===l.length&&(a=s(T.Z.shareSuccessTitleOnlySharing),r=s(T.Z.shareSuccessDescriptionOnlySharing,{name:u(),group:C(i.map((function(e){return e.groupName})),s),b:V.d})),!c&&!p&&l.length>0&&(a=s(T.Z.shareSuccessTitleOnlyChaningPermissions),r=s(T.Z.shareSuccessDescriptionOnlyChaningPermissions,{group:C(l.map((function(e){return e.groupName})),s),b:V.d})),{title:a,description:r}}({shareData:t,initialGroups:o,removedGroups:i.map((function(e){var r=e.permissions,t=A(e,["permissions"]);return H(H({},t),{permissions:r.join(",")})})),newGroups:n,formatMessage:q,portfolioName:W}),c=l.title,p=l.description;return Promise.all(u).then((function(){return z({type:D.Dv,payload:{dismissable:!0,variant:"success",title:c,description:p}}),z(localStorage.getItem("catalog_standalone")?(0,g.eV)(L):(0,d.eV)(L))}))},onCancel:se,validate:function(e){var r={};return e.group_uuid&&!e.permissions&&(r.permissions=q(T.Z.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(r.group_uuid=q(T.Z.portfolioShareGroups)),r},initialValues:H(H({},ne),{"shared-groups":ie.map((function(e){var r=e.permissions.filter((function(e){return h.W5.indexOf(e)>-1})),t=e.group_name,n=h.nR.find((function(e){return e.value===r.sort().join(",")}));return{groupName:t,group_uuid:localStorage.getItem("catalog_standalone")?e.group:e.group_uuid,permissions:n?n.value:q(G.Z.unknown)}}))}),templateProps:{disableSubmit:["pristine","validating"],submitLabel:q(T.Z.portfolioShareApply)}}))))}},74798:(e,r,t)=>{t.d(r,{Z:()=>i});var n=t(334),o=function(){return(o=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};const i=function(e){var r=void 0===e?{}:e,t=r.removeSearch,i=r.keepHash,s=(0,n.useHistory)();return o(o({},s),{push:function(e){var r=e;return i&&s.location.hash.length>0&&(r="object"==typeof r?o(o({},r),{hash:s.location.hash}):""+r+s.location.hash),t?s.push(function(e){return"string"==typeof e?e.split("?")[0]:"object"==typeof e?o(o({},e),{search:void 0}):e}(r)):s.push(r)}})}}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio.71fcb6e7ffd905f86a7af558bc32c4f0.js.map