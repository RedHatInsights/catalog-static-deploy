"use strict";(self.webpackChunkcatalog=self.webpackChunkcatalog||[]).push([[8249],{35809:(e,r,n)=>{n.r(r),n.d(r,{default:()=>A});var t=n(30624),o=n.n(t),i=n(30137),u=n(45237),s=n(18446),a=n.n(s),l=n(15040),p=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},c=function(e,r){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:r}]}]},f=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},d=n(89231),m=n(15654),g=n(35388),h=(0,m.Hx)(),v=(0,m._f)(),y=function(e){return h.get(g.Vs+"/portfolios/"+e+"/share_info")},b=n(90060),S=function(){return(S=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},_=function(e){return{type:b.cc,payload:(r=S({},e),n={permissions:r.permissions.split(","),group_uuids:[r.group_uuid]},v.sharePortfolio(r.id,n))};var r,n},O=function(e){return{type:b.tD,payload:(r=S({},e),n={permissions:r.permissions,group_uuids:[r.group_uuid]},v.unsharePortfolio(r.id,n))};var r,n},Z=n(8666),P=((0,m.o0)(),n(47786)),w=n(74798),E=n(9456),j=n(64466),k=n(83215),G=n(97881),D=n(23349),N=n(56915),T=function(e,r){switch(e.length){case 1:return e[0];case 2:return r(j.Z.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return r(j.Z.shareSuccessMultipleGroups,{count:e.length})}};var x=function(){return(x=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},C=function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)r.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(n[t[o]]=e[t[o]])}return n},I=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))};const A=function(e){var r,n,s,h,v,S,A,M,V=e.closeUrl,L=e.removeSearch,R=e.viewState,H=e.portfolioName,U=void 0===H?function(){return""}:H,J=(0,D.Z)(),W=(0,u.useDispatch)(),q=(0,w.Z)({removeSearch:L,keepHash:!0}).push,z=(0,P.Z)(["portfolio"]),B=z[0].portfolio,F=z[1],K=(0,t.useState)(!0),Q=K[0],X=K[1],Y=(0,u.useSelector)((function(e){var r=e.portfolioReducer;return{selectedPortfolio:r.selectedPortfolio,isLoading:r.isLoading}})),$=Y.selectedPortfolio,ee=Y.isLoading,re=(0,u.useSelector)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;(0,t.useEffect)((function(){var e;X(!0),W((e=B,{type:b.oI,payload:y(e)})).then((function(){return X(!1)})).catch((function(){return X(!1)}))}),[]);var ne=function(){W((0,d.So)()),q({pathname:V,search:F})};if(!1===(null===(n=null===(r=null==$?void 0:$.metadata)||void 0===r?void 0:r.user_capabilities)||void 0===n?void 0:n.share)&&!1===(null===(h=null===(s=null==$?void 0:$.metadata)||void 0===s?void 0:s.user_capabilities)||void 0===h?void 0:h.unshare))return o().createElement(E.M,null);var te,oe,ie,ue,se=Q||ee;return o().createElement(l.Modal,{title:J(j.Z.portfolioShareTitle),isOpen:!0,variant:"small",onClose:ne},se&&o().createElement(Z.Aj,null),!se&&o().createElement(l.Stack,{hasGutter:!0},o().createElement(l.StackItem,null,o().createElement(l.TextContent,null,o().createElement(l.Text,null,J(j.Z.portfolioShareDescription,{name:U(B),strong:function(e){return o().createElement("strong",{key:"strong"},e)}})))),o().createElement(l.StackItem,null,o().createElement(i.ZP,{schema:(te=function(e){return void 0===(r=e)&&(r=""),(0,m.Hx)().get(g.OJ+"/groups/"+(r.length>0?"?name="+r:"")).then((function(e){return e.data.map((function(e){var r=e.uuid;return{label:e.name,value:r}}))}));var r},oe=g.nR,ie=!1!==(null===(S=null===(v=null==$?void 0:$.metadata)||void 0===v?void 0:v.user_capabilities)||void 0===S?void 0:S.share),ue=!1!==(null===(M=null===(A=null==$?void 0:$.metadata)||void 0===A?void 0:A.user_capabilities)||void 0===M?void 0:M.unshare),{fields:p(p([],ie?c(te,oe):[],!0),ue?f(oe):[],!0)}),onSubmit:function(e,r){var n=e["shared-groups"],t=[],o=r.getState().initialValues["shared-groups"],i=o.filter((function(e){return!n.find((function(r){return r.group_uuid===e.group_uuid}))})).map((function(e){var r=e.permissions,n=C(e,["permissions"]);return x(x({},n),{permissions:r.split(",")})}));n.forEach((function(e){var r=o.find((function(r){return r.group_uuid===e.group_uuid}));r&&!a()(r,e)&&(r.permissions.length>e.permissions.length?i.push({id:B,permissions:["update"],group_uuid:e.group_uuid,groupName:e.groupName}):t.push(e)),r||t.push(e)}));var u=function(e,r){return void 0===r&&(r=!1),W((r?O:_)({id:B,permissions:e.permissions,group_uuid:e.group_uuid}))},s=I(I([],t.map((function(e){return u(e)})),!0),i.map((function(e){return u(e,!0)})),!0);ne();var l=function(e){var r,n=e.shareData,t=e.initialGroups,o=e.removedGroups,i=e.newGroups,u=e.formatMessage,s=e.portfolioName,a=u(j.Z.shareSuccessTitle),l=n.filter((function(e){var r,n=e.permissions,o=e.group_uuid,i=t.find((function(e){return e.group_uuid===o}));return i&&(null==n?void 0:n.split(",").length)!==(null===(r=i.permissions)||void 0===r?void 0:r.split(",").length)})),p=o.filter((function(e){var r=e.group_uuid;return!l.find((function(e){return e.group_uuid===r}))})).length>0,c=i.filter((function(e){var r=e.group_uuid;return!t.find((function(e){return e.group_uuid===r}))})).length>0;return p&&!c&&0===l.length&&(a=u(j.Z.shareSuccessTitleOnlyUnsharing),r=u(j.Z.shareSuccessDescriptionOnlyUnsharing,{name:s(),group:T(o.map((function(e){return e.groupName})),u),b:N.d})),!p&&c&&0===l.length&&(a=u(j.Z.shareSuccessTitleOnlySharing),r=u(j.Z.shareSuccessDescriptionOnlySharing,{name:s(),group:T(i.map((function(e){return e.groupName})),u),b:N.d})),!p&&!c&&l.length>0&&(a=u(j.Z.shareSuccessTitleOnlyChaningPermissions),r=u(j.Z.shareSuccessDescriptionOnlyChaningPermissions,{group:T(l.map((function(e){return e.groupName})),u),b:N.d})),{title:a,description:r}}({shareData:n,initialGroups:o,removedGroups:i.map((function(e){var r=e.permissions,n=C(e,["permissions"]);return x(x({},n),{permissions:r.join(",")})})),newGroups:t,formatMessage:J,portfolioName:U}),p=l.title,c=l.description;return Promise.all(s).then((function(){return W({type:k.Dv,payload:{dismissable:!0,variant:"success",title:p,description:c}}),W((0,d.eV)(R))}))},onCancel:ne,validate:function(e){var r={};return e.group_uuid&&!e.permissions&&(r.permissions=J(j.Z.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(r.group_uuid=J(j.Z.portfolioShareGroups)),r},initialValues:x(x({},$),{"shared-groups":re.map((function(e){var r=e.permissions.filter((function(e){return g.W5.indexOf(e)>-1})),n=e.group_name,t=g.nR.find((function(e){return e.value===r.sort().join(",")}));return{groupName:n,group_uuid:e.group_uuid,permissions:t?t.value:J(G.Z.unknown)}}))}),templateProps:{disableSubmit:["pristine","validating"],submitLabel:J(j.Z.portfolioShareApply)}}))))}}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio.02b4cb514c117f62c8f2f55ea9ffa17f.js.map