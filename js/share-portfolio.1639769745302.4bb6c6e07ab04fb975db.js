"use strict";(self.webpackChunkcatalog=self.webpackChunkcatalog||[]).push([[8249],{97881:(e,r,n)=>{n.d(r,{Z:()=>t});const t=(0,n(50049).vU)({noItems:{id:"common.filtering.noItems",defaultMessage:"No items found"},filterByProduct:{id:"common.filtering.filterByProduct",defaultMessage:"Filter by product"},noResults:{id:"common.filtering.noResults",defaultMessage:"No results found"},noResultsDescription:{id:"common.filtering.noResultsDescription",defaultMessage:"No results match the filter criteria. Remove all filters or clear all filters to show results."},clearFilters:{id:"common.filtering.clear-filters",defaultMessage:"Clear all filters"},noProducts:{id:"common.filtering.no-products",defaultMessage:"No products yet"},noRecords:{id:"commonMessages.noRecords",defaultMessage:"No records"},filterByTitle:{id:"tableToolbar.filterByTitle",defaultMessage:"Filter by {title}"},noResultsFound:{id:"tableToolbar.noResultsFound",defaultMessage:"No results found"},noResult:{id:"tableToolbar.noResult",defaultMessage:"No {results}"},unknown:{id:"commonMessages.unknown",defaultMessage:"Unknown"}})},35809:(e,r,n)=>{n.r(r),n.d(r,{default:()=>C});var t=n(30624),o=n.n(t),i=n(30137),s=n(14494),u=n(18446),a=n.n(u),l=n(65832),c=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))},p=function(e,r){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:r}]}]},f=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},d=n(89231),m=n(22437),g=n(35388),h=(0,m.Hx)(),v=(0,m._f)(),y=function(e){return h.get(g.Vs+"/portfolios/"+e+"/share_info")},b=n(90060),S=function(){return(S=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},_=function(e){return{type:b.cc,payload:(r=S({},e),n={permissions:r.permissions.split(","),group_uuids:[r.group_uuid]},v.sharePortfolio(r.id,n))};var r,n},O=function(e){return{type:b.tD,payload:(r=S({},e),n={permissions:r.permissions,group_uuids:[r.group_uuid]},v.unsharePortfolio(r.id,n))};var r,n},Z=n(8666),w=((0,m.o0)(),n(47786)),P=n(74798),M=n(9456),N=n(64466),j=n(83215),k=n(97881),R=n(23349),E=n(56915),T=function(e,r){switch(e.length){case 1:return e[0];case 2:return r(N.Z.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return r(N.Z.shareSuccessMultipleGroups,{count:e.length})}};var D=function(){return(D=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},G=function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)r.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(n[t[o]]=e[t[o]])}return n},I=function(e,r,n){if(n||2===arguments.length)for(var t,o=0,i=r.length;o<i;o++)!t&&o in r||(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))};const C=function(e){var r,n,u,h,v,S,C,x,A=e.closeUrl,F=e.removeSearch,H=e.viewState,U=e.portfolioName,V=void 0===U?function(){return""}:U,B=(0,R.Z)(),L=(0,s.I0)(),J=(0,P.Z)({removeSearch:F,keepHash:!0}).push,W=(0,w.Z)(["portfolio"]),q=W[0].portfolio,z=W[1],K=(0,t.useState)(!0),Q=K[0],X=K[1],Y=(0,s.v9)((function(e){var r=e.portfolioReducer;return{selectedPortfolio:r.selectedPortfolio,isLoading:r.isLoading}})),$=Y.selectedPortfolio,ee=Y.isLoading,re=(0,s.v9)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;(0,t.useEffect)((function(){var e;X(!0),L((e=q,{type:b.oI,payload:y(e)})).then((function(){return X(!1)})).catch((function(){return X(!1)}))}),[]);var ne=function(){L((0,d.So)()),J({pathname:A,search:z})};if(!1===(null===(n=null===(r=null==$?void 0:$.metadata)||void 0===r?void 0:r.user_capabilities)||void 0===n?void 0:n.share)&&!1===(null===(h=null===(u=null==$?void 0:$.metadata)||void 0===u?void 0:u.user_capabilities)||void 0===h?void 0:h.unshare))return o().createElement(M.M,null);var te,oe,ie,se,ue=Q||ee;return o().createElement(l.Modal,{title:B(N.Z.portfolioShareTitle),isOpen:!0,variant:"small",onClose:ne},ue&&o().createElement(Z.Aj,null),!ue&&o().createElement(l.Stack,{hasGutter:!0},o().createElement(l.StackItem,null,o().createElement(l.TextContent,null,o().createElement(l.Text,null,B(N.Z.portfolioShareDescription,{name:V(q),strong:function(e){return o().createElement("strong",{key:"strong"},e)}})))),o().createElement(l.StackItem,null,o().createElement(i.ZP,{schema:(te=function(e){return void 0===(r=e)&&(r=""),(0,m.Hx)().get(g.OJ+"/groups/"+(r.length>0?"?name="+r:"")).then((function(e){return e.data.map((function(e){var r=e.uuid;return{label:e.name,value:r}}))}));var r},oe=g.nR,ie=!1!==(null===(S=null===(v=null==$?void 0:$.metadata)||void 0===v?void 0:v.user_capabilities)||void 0===S?void 0:S.share),se=!1!==(null===(x=null===(C=null==$?void 0:$.metadata)||void 0===C?void 0:C.user_capabilities)||void 0===x?void 0:x.unshare),{fields:c(c([],ie?p(te,oe):[],!0),se?f(oe):[],!0)}),onSubmit:function(e,r){var n=e["shared-groups"],t=[],o=r.getState().initialValues["shared-groups"],i=o.filter((function(e){return!n.find((function(r){return r.group_uuid===e.group_uuid}))})).map((function(e){var r=e.permissions,n=G(e,["permissions"]);return D(D({},n),{permissions:r.split(",")})}));n.forEach((function(e){var r=o.find((function(r){return r.group_uuid===e.group_uuid}));r&&!a()(r,e)&&(r.permissions.length>e.permissions.length?i.push({id:q,permissions:["update"],group_uuid:e.group_uuid,groupName:e.groupName}):t.push(e)),r||t.push(e)}));var s=function(e,r){return void 0===r&&(r=!1),L((r?O:_)({id:q,permissions:e.permissions,group_uuid:e.group_uuid}))},u=I(I([],t.map((function(e){return s(e)})),!0),i.map((function(e){return s(e,!0)})),!0);ne();var l=function(e){var r,n=e.shareData,t=e.initialGroups,o=e.removedGroups,i=e.newGroups,s=e.formatMessage,u=e.portfolioName,a=s(N.Z.shareSuccessTitle),l=n.filter((function(e){var r,n=e.permissions,o=e.group_uuid,i=t.find((function(e){return e.group_uuid===o}));return i&&(null==n?void 0:n.split(",").length)!==(null===(r=i.permissions)||void 0===r?void 0:r.split(",").length)})),c=o.filter((function(e){var r=e.group_uuid;return!l.find((function(e){return e.group_uuid===r}))})).length>0,p=i.filter((function(e){var r=e.group_uuid;return!t.find((function(e){return e.group_uuid===r}))})).length>0;return c&&!p&&0===l.length&&(a=s(N.Z.shareSuccessTitleOnlyUnsharing),r=s(N.Z.shareSuccessDescriptionOnlyUnsharing,{name:u(),group:T(o.map((function(e){return e.groupName})),s),b:E.d})),!c&&p&&0===l.length&&(a=s(N.Z.shareSuccessTitleOnlySharing),r=s(N.Z.shareSuccessDescriptionOnlySharing,{name:u(),group:T(i.map((function(e){return e.groupName})),s),b:E.d})),!c&&!p&&l.length>0&&(a=s(N.Z.shareSuccessTitleOnlyChaningPermissions),r=s(N.Z.shareSuccessDescriptionOnlyChaningPermissions,{group:T(l.map((function(e){return e.groupName})),s),b:E.d})),{title:a,description:r}}({shareData:n,initialGroups:o,removedGroups:i.map((function(e){var r=e.permissions,n=G(e,["permissions"]);return D(D({},n),{permissions:r.join(",")})})),newGroups:t,formatMessage:B,portfolioName:V}),c=l.title,p=l.description;return Promise.all(u).then((function(){return L({type:j.Dv,payload:{dismissable:!0,variant:"success",title:c,description:p}}),L((0,d.eV)(H))}))},onCancel:ne,validate:function(e){var r={};return e.group_uuid&&!e.permissions&&(r.permissions=B(N.Z.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(r.group_uuid=B(N.Z.portfolioShareGroups)),r},initialValues:D(D({},$),{"shared-groups":re.map((function(e){var r=e.permissions.filter((function(e){return g.W5.indexOf(e)>-1})),n=e.group_name,t=g.nR.find((function(e){return e.value===r.sort().join(",")}));return{groupName:n,group_uuid:e.group_uuid,permissions:t?t.value:B(k.Z.unknown)}}))}),templateProps:{disableSubmit:["pristine","validating"],submitLabel:B(N.Z.portfolioShareApply)}}))))}},74798:(e,r,n)=>{n.d(r,{Z:()=>i});var t=n(334),o=function(){return(o=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};const i=function(e){var r=void 0===e?{}:e,n=r.removeSearch,i=r.keepHash,s=(0,t.useHistory)();return o(o({},s),{push:function(e){var r=e;return i&&s.location.hash.length>0&&(r="object"==typeof r?o(o({},r),{hash:s.location.hash}):""+r+s.location.hash),n?s.push(function(e){return"string"==typeof e?e.split("?")[0]:"object"==typeof e?o(o({},e),{search:void 0}):e}(r)):s.push(r)}})}}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio.7b25c4dcf235663777593eed373b438a.js.map