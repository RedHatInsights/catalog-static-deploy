(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{578:function(e,t,r){"use strict";var n=r(21),o=Object(n.b)({noItems:{id:"common.filtering.noItems",defaultMessage:"No items found"},filterByProduct:{id:"common.filtering.filterByProduct",defaultMessage:"Filter by product"},noResults:{id:"common.filtering.noResults",defaultMessage:"No results found"},noResultsDescription:{id:"common.filtering.noResultsDescription",defaultMessage:"No results match the filter criteria. Remove all filters or clear all filters to show results."},clearFilters:{id:"common.filtering.clear-filters",defaultMessage:"Clear all filters"},noProducts:{id:"common.filtering.no-products",defaultMessage:"No products yet"},noRecords:{id:"commonMessages.noRecords",defaultMessage:"No records"},filterByTitle:{id:"tableToolbar.filterByTitle",defaultMessage:"Filter by {title}"},noResultsFound:{id:"tableToolbar.noResultsFound",defaultMessage:"No results found"},noResult:{id:"tableToolbar.noResult",defaultMessage:"No {results}"},unknown:{id:"commonMessages.unknown",defaultMessage:"Unknown"}});t.a=o},581:function(e,t,r){var n=r(589),o=r(590),i=r(290),u=r(591);e.exports=function(e){return n(e)||o(e)||i(e)||u()}},582:function(e,t,r){"use strict";var n=r(85),o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};t.a=function(e){var t=void 0===e?{}:e,r=t.removeSearch,i=t.keepHash,u=Object(n.g)();return o(o({},u),{push:function(e){var t=e;return i&&u.location.hash.length>0&&(t="object"==typeof t?o(o({},t),{hash:u.location.hash}):""+t+u.location.hash),r?u.push(function(e){return"string"==typeof e?e.split("?")[0]:"object"==typeof e?o(o({},e),{search:void 0}):e}(t)):u.push(t)}})}},589:function(e,t,r){var n=r(291);e.exports=function(e){if(Array.isArray(e))return n(e)}},590:function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},591:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},611:function(e,t,r){var n=r(770);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},764:function(e,t,r){var n=r(765);e.exports=function(e,t){return n(e,t)}},765:function(e,t,r){var n=r(766),o=r(309);e.exports=function e(t,r,i,u,a){return t===r||(null==t||null==r||!o(t)&&!o(r)?t!=t&&r!=r:n(t,r,i,u,e,a))}},766:function(e,t,r){var n=r(767),o=r(774),i=r(776),u=r(777),a=r(780),s=r(110),c=r(781),l=r(782),f="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,d,h,m){var g=s(e),v=s(t),b=g?"[object Array]":a(e),y=v?"[object Array]":a(t),O=(b="[object Arguments]"==b?f:b)==f,_=(y="[object Arguments]"==y?f:y)==f,j=b==y;if(j&&c(e)){if(!c(t))return!1;g=!0,O=!1}if(j&&!O)return m||(m=new n),g||l(e)?o(e,t,r,d,h,m):i(e,t,b,r,d,h,m);if(!(1&r)){var w=O&&p.call(e,"__wrapped__"),S=_&&p.call(t,"__wrapped__");if(w||S){var P=w?e.value():e,x=S?t.value():t;return m||(m=new n),h(P,x,r,d,m)}}return!!j&&(m||(m=new n),u(e,t,r,d,h,m))}},767:function(e,t,r){var n=r(768),o=r(769),i=r(771),u=r(772),a=r(773);function s(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}s.prototype.clear=n,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=u,s.prototype.set=a,e.exports=s},768:function(e,t){e.exports=function(){this.__data__=[],this.size=0}},769:function(e,t,r){var n=r(611),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():o.call(t,r,1),--this.size,!0)}},770:function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},771:function(e,t,r){var n=r(611);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},772:function(e,t,r){var n=r(611);e.exports=function(e){return n(this.__data__,e)>-1}},773:function(e,t,r){var n=r(611);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},774:function(e,t,r){var n=r(307),o=r(775),i=r(308);e.exports=function(e,t,r,u,a,s){var c=1&r,l=e.length,f=t.length;if(l!=f&&!(c&&f>l))return!1;var p=s.get(e);if(p&&s.get(t))return p==t;var d=-1,h=!0,m=2&r?new n:void 0;for(s.set(e,t),s.set(t,e);++d<l;){var g=e[d],v=t[d];if(u)var b=c?u(v,g,d,t,e,s):u(g,v,d,e,t,s);if(void 0!==b){if(b)continue;h=!1;break}if(m){if(!o(t,(function(e,t){if(!i(m,t)&&(g===e||a(g,e,r,u,s)))return m.push(t)}))){h=!1;break}}else if(g!==v&&!a(g,v,r,u,s)){h=!1;break}}return s.delete(e),s.delete(t),h}},775:function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},776:function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},777:function(e,t,r){var n=r(778),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,i,u,a){var s=1&r,c=n(e),l=c.length;if(l!=n(t).length&&!s)return!1;for(var f=l;f--;){var p=c[f];if(!(s?p in t:o.call(t,p)))return!1}var d=a.get(e);if(d&&a.get(t))return d==t;var h=!0;a.set(e,t),a.set(t,e);for(var m=s;++f<l;){var g=e[p=c[f]],v=t[p];if(i)var b=s?i(v,g,p,t,e,a):i(g,v,p,e,t,a);if(!(void 0===b?g===v||u(g,v,r,i,a):b)){h=!1;break}m||(m="constructor"==p)}if(h&&!m){var y=e.constructor,O=t.constructor;y==O||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof O&&O instanceof O||(h=!1)}return a.delete(e),a.delete(t),h}},778:function(e,t,r){var n=r(779)(Object.keys,Object);e.exports=n},779:function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},780:function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},781:function(e,t){e.exports=function(){return!1}},782:function(e,t){e.exports=function(){return!1}},947:function(e,t,r){"use strict";r.r(t);var n=r(581),o=r.n(n),i=r(13),u=r.n(i),a=r(70),s=r.n(a),c=r(26),l=r.n(c),f=r(0),p=r.n(f),d=r(4),h=r.n(d),m=r(178),g=r(19),v=r(764),b=r.n(v),y=r(177),O=r(39),_=r(38),j=r(181),w=r(139),S=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],u=0,a=i.length;u<a;u++,o++)n[o]=i[u];return n},P=function(e,t){return[{component:"sub-form",description:"share.new.description",name:"new_share",key:"1",fields:[{name:"group-selection",component:"share-group-select",loadOptions:e,isSearchable:!0,permissions:t}]}]},x=function(e){return[{component:"sub-form",name:"current-groups-sub-form",fields:[{name:"shared-groups",permissionVerbs:e,component:"share-group-edit"}]}]},k=function(e,t,r,n){return{fields:S(r?P(e,t):[],n?x(t):[])}},D=r(135),T=r(22),E=r(5),M=Object(T.a)(),N=Object(T.f)(),R=function(e){return M.get(E.e+"/portfolios/"+e+"/share_info")},A=r(3);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=function(e){return{type:A.ab,payload:(t=G({},e),r={permissions:t.permissions.split(","),group_uuids:[t.group_uuid]},N.sharePortfolio(t.id,r))};var t,r},F=function(e){return{type:A.db,payload:(t=G({},e),r={permissions:t.permissions,group_uuids:[t.group_uuid]},N.unsharePortfolio(t.id,r))};var t,r},U=r(87),B=(Object(T.h)(),r(86)),L=r(582),z=r(188),V=r(48),H=r(29),J=r(578),q=r(18),K=r(195),Q=function(e,t){switch(e.length){case 1:return e[0];case 2:return t(V.a.shareSuccessTwoGroup,{group1:e[0],group2:e[1]});default:return t(V.a.shareSuccessMultipleGroups,{count:e.length})}},W=function(e){var t,r=e.shareData,n=e.initialGroups,o=e.removedGroups,i=e.newGroups,u=e.formatMessage,a=e.portfolioName,s=u(V.a.shareSuccessTitle),c=r.filter((function(e){var t,r=e.permissions,o=e.group_uuid,i=n.find((function(e){return e.group_uuid===o}));return i&&(null==r?void 0:r.split(",").length)!==(null===(t=i.permissions)||void 0===t?void 0:t.split(",").length)})),l=o.filter((function(e){var t=e.group_uuid;return!c.find((function(e){return e.group_uuid===t}))})).length>0,f=i.filter((function(e){var t=e.group_uuid;return!n.find((function(e){return e.group_uuid===t}))})).length>0;return l&&!f&&0===c.length&&(s=u(V.a.shareSuccessTitleOnlyUnsharing),t=u(V.a.shareSuccessDescriptionOnlyUnsharing,{name:a(),group:Q(o.map((function(e){return e.groupName})),u),b:K.a})),!l&&f&&0===c.length&&(s=u(V.a.shareSuccessTitleOnlySharing),t=u(V.a.shareSuccessDescriptionOnlySharing,{name:a(),group:Q(i.map((function(e){return e.groupName})),u),b:K.a})),!l&&!f&&c.length>0&&(s=u(V.a.shareSuccessTitleOnlyChaningPermissions),t=u(V.a.shareSuccessDescriptionOnlyChaningPermissions,{group:Q(c.map((function(e){return e.groupName})),u),b:K.a})),{title:s,description:t}};function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Z=function(e){var t,r,n,i,u,a,c,d,h=e.closeUrl,v=e.removeSearch,S=e.viewState,P=e.portfolioName,x=void 0===P?function(){return""}:P,M=Object(q.a)(),N=Object(g.useDispatch)(),I=Object(L.a)({removeSearch:v,keepHash:!0}).push,G=Object(B.a)(["portfolio"]),K=l()(G,2),Q=K[0].portfolio,X=K[1],Z=Object(f.useState)(!0),$=l()(Z,2),ee=$[0],te=$[1],re=Object(g.useSelector)((function(e){var t=e.portfolioReducer;return{selectedPortfolio:t.selectedPortfolio,isLoading:t.isLoading}})),ne=re.selectedPortfolio,oe=re.isLoading,ie=Object(g.useSelector)((function(e){return{shareInfo:e.shareReducer.shareInfo}})).shareInfo;Object(f.useEffect)((function(){var e;te(!0),N((e=Q,{type:A.G,payload:R(e)})).then((function(){return te(!1)})).catch((function(){return te(!1)}))}),[]);var ue=function(){N(Object(D.m)()),I({pathname:h,search:X})};if(!1===(null==ne||null===(t=ne.metadata)||void 0===t||null===(r=t.user_capabilities)||void 0===r?void 0:r.share)&&!1===(null==ne||null===(n=ne.metadata)||void 0===n||null===(i=n.user_capabilities)||void 0===i?void 0:i.unshare))return p.a.createElement(z.a,null);var ae=ee||oe;return p.a.createElement(y.Modal,{title:M(V.a.portfolioShareTitle),isOpen:!0,variant:"small",onClose:ue},ae&&p.a.createElement(U.i,null),!ae&&p.a.createElement(j.Stack,{hasGutter:!0},p.a.createElement(w.StackItem,null,p.a.createElement(O.TextContent,null,p.a.createElement(_.Text,null,M(V.a.portfolioShareDescription,{name:x(Q),strong:function(e){return p.a.createElement("strong",{key:"strong"},e)}})))),p.a.createElement(w.StackItem,null,p.a.createElement(m.c,{schema:k((function(e){return void 0===(t=e)&&(t=""),Object(T.a)().get(E.j+"/groups/"+(t.length>0?"?name="+t:"")).then((function(e){return e.data.map((function(e){var t=e.uuid;return{label:e.name,value:t}}))}));var t}),E.m,!1!==(null==ne||null===(u=ne.metadata)||void 0===u||null===(a=u.user_capabilities)||void 0===a?void 0:a.share),!1!==(null==ne||null===(c=ne.metadata)||void 0===c||null===(d=c.user_capabilities)||void 0===d?void 0:d.unshare)),schemaType:"default",onSubmit:function(e,t){var r=e["shared-groups"],n=[],i=t.getState().initialValues["shared-groups"],u=i.filter((function(e){return!r.find((function(t){return t.group_uuid===e.group_uuid}))})).map((function(e){var t=e.permissions;return Y(Y({},s()(e,["permissions"])),{},{permissions:t.split(",")})}));r.forEach((function(e){var t=i.find((function(t){return t.group_uuid===e.group_uuid}));t&&!b()(t,e)&&(t.permissions.length>e.permissions.length?u.push({id:Q,permissions:["update"],group_uuid:e.group_uuid}):n.push(e)),t||n.push(e)}));var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?F:C;return N(r({id:Q,permissions:e.permissions,group_uuid:e.group_uuid}))},c=[].concat(o()(n.map((function(e){return a(e)}))),o()(u.map((function(e){return a(e,!0)}))));ue();var l=W({shareData:r,initialGroups:i,removedGroups:u,newGroups:n,formatMessage:M,portfolioName:x}),f=l.title,p=l.description;return Promise.all(c).then((function(){return N({type:H.ADD_NOTIFICATION,payload:{dismissable:!0,variant:"success",title:f,description:p}}),N(Object(D.g)(S))}))},onCancel:ue,validate:function(e){var t={};return e.group_uuid&&!e.permissions&&(t.permissions=M(V.a.portfolioSharePermissions)),e.permissions&&!e.group_uuid&&(t.group_uuid=M(V.a.portfolioShareGroups)),t},initialValues:Y(Y({},ne),{},{"shared-groups":ie.map((function(e){var t=e.permissions.filter((function(e){return E.n.indexOf(e)>-1})),r=e.group_name,n=E.m.find((function(e){return e.value===t.sort().join(",")}));return{groupName:r,group_uuid:e.group_uuid,permissions:n?n.value:M(J.a.unknown)}}))}),templateProps:{disableSubmit:["pristine","validating"],submitLabel:M(V.a.portfolioShareApply)}}))))};Z.propTypes={closeUrl:h.a.string.isRequired,removeSearch:h.a.bool,portfolioName:h.a.func,viewState:h.a.shape({count:h.a.number,limit:h.a.number,offset:h.a.number,filter:h.a.string})};t.default=Z}}]);
//# sourceMappingURL=../sourcemaps/share-portfolio~31ecd969.js.map